
 <!DOCTYPE HTML>
<html >
<head>
  <meta charset="UTF-8">
  
    <title>Hexo</title>
    <meta name="viewport" content="width=device-width, initial-scale=1,user-scalable=no">
    
    <meta name="author" content="John Doe">
    

    
    <meta name="description" content="限制EditText输入的字数xml: &amp;lt;FrameLayout         android:layout_width=&amp;quot;wrap_content&amp;quot;         android:layout_height=&amp;quot;wrap_content&amp;quot;&amp;gt;          &amp;lt;EditText             android:id=&amp;quot;">
<meta property="og:type" content="article">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="http://yoursite.com/2018/01/28/android/小细节/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="限制EditText输入的字数xml: &amp;lt;FrameLayout         android:layout_width=&amp;quot;wrap_content&amp;quot;         android:layout_height=&amp;quot;wrap_content&amp;quot;&amp;gt;          &amp;lt;EditText             android:id=&amp;quot;">
<meta property="og:image" content="http://p2qa028as.bkt.clouddn.com/blog/180125/EFHHHh9CLf.png?imageslim">
<meta property="og:image" content="http://p2qa028as.bkt.clouddn.com/blog/180125/I01gHjh9gI.png?imageslim">
<meta property="og:image" content="http://p2qa028as.bkt.clouddn.com/blog/180125/JLbjFh6GCf.png?imageslim">
<meta property="og:image" content="http://yoursite.com/2018/01/28/android/小细节/pic/imageView%E4%B8%AD%E7%9A%84%E5%9B%BE%E7%89%87%E9%BB%98%E8%AE%A4%E5%90%91%E4%B8%8A%E5%92%8C%E5%90%91%E5%B7%A6%E5%81%8F%E7%A7%BB.png">
<meta property="og:updated_time" content="2018-01-28T14:13:59.050Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Hexo">
<meta name="twitter:description" content="限制EditText输入的字数xml: &amp;lt;FrameLayout         android:layout_width=&amp;quot;wrap_content&amp;quot;         android:layout_height=&amp;quot;wrap_content&amp;quot;&amp;gt;          &amp;lt;EditText             android:id=&amp;quot;">
<meta name="twitter:image" content="http://p2qa028as.bkt.clouddn.com/blog/180125/EFHHHh9CLf.png?imageslim">

    
    <link rel="alternative" href="/atom.xml" title="Hexo" type="application/atom+xml">
    
    
    <link rel="icon" href="/img/favicon.ico">
    
    
    <link rel="apple-touch-icon" href="/img/jacman.jpg">
    <link rel="apple-touch-icon-precomposed" href="/img/jacman.jpg">
    
    <link rel="stylesheet" href="/css/style.css">
</head>

  <body>
    <header>
      
<div>
		
			<div id="imglogo">
				<a href="/"><img src="/img/logo.png" alt="Hexo" title="Hexo"/></a>
			</div>
			
			<div id="textlogo">
				<h1 class="site-name"><a href="/" title="Hexo">Hexo</a></h1>
				<h2 class="blog-motto"></h2>
			</div>
			<div class="navbar"><a class="navbutton navmobile" href="#" title="Menu">
			</a></div>
			<nav class="animated">
				<ul>
					<ul>
					 
						<li><a href="/">Home</a></li>
					
						<li><a href="/archives">Archives</a></li>
					
						<li><a href="/about">About</a></li>
					
					<li>
 					
					<form class="search" action="/search/index.html" method="get" accept-charset="utf-8">
						<label>Search</label>
						<input type="search" id="search" autocomplete="off" name="q" maxlength="20" placeholder="Search" />
					</form>
					
					</li>
				</ul>
			</nav>			
</div>
    </header>
    <div id="container">
      <div id="main" class="post" itemscope itemprop="blogPost">
  
	<article itemprop="articleBody"> 
		<header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2018/01/28/android/小细节/" title="" itemprop="url"></a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="John Doe" target="_blank" itemprop="author">John Doe</a>
		
  <p class="article-time">
    <time datetime="2018-01-28T14:13:59.000Z" itemprop="datePublished"> Published 2018-01-28</time>
    
  </p>
</header>
	<div class="article-content">
		
		<div id="toc" class="toc-article">
			<strong class="toc-title">Contents</strong>
		
			<ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#限制EditText输入的字数"><span class="toc-number">1.</span> <span class="toc-text">限制EditText输入的字数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#EditText只接受数字，其余无法输入到EditText中"><span class="toc-number">2.</span> <span class="toc-text">EditText只接受数字，其余无法输入到EditText中</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#EditText修改Cursor颜色"><span class="toc-number">3.</span> <span class="toc-text">EditText修改Cursor颜色</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#EditText密码输入框的可见与不可见切换"><span class="toc-number">4.</span> <span class="toc-text">EditText密码输入框的可见与不可见切换</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#EditText属性设置"><span class="toc-number">5.</span> <span class="toc-text">EditText属性设置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#android-windowSoftInputMode属性详解"><span class="toc-number">6.</span> <span class="toc-text">android:windowSoftInputMode属性详解</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Android-MarginLeft与MarginStart的区别"><span class="toc-number">7.</span> <span class="toc-text">Android MarginLeft与MarginStart的区别</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Fragment数据懒加载"><span class="toc-number">8.</span> <span class="toc-text">Fragment数据懒加载</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ScrollView嵌套LinearLayout-LinearLayout不铺满屏幕问题"><span class="toc-number">9.</span> <span class="toc-text">ScrollView嵌套LinearLayout,LinearLayout不铺满屏幕问题</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#RecyclerView使用注意"><span class="toc-number">10.</span> <span class="toc-text">RecyclerView使用注意</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#实现嵌套滑动"><span class="toc-number">11.</span> <span class="toc-text">实现嵌套滑动</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#java继承细节"><span class="toc-number">12.</span> <span class="toc-text">java继承细节</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ScrollView监听滑动到底部和顶部"><span class="toc-number">13.</span> <span class="toc-text">ScrollView监听滑动到底部和顶部</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#属性动画"><span class="toc-number">14.</span> <span class="toc-text">属性动画</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#自定义View-ViewGroup的过程"><span class="toc-number">15.</span> <span class="toc-text">自定义View/ViewGroup的过程</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#一些特殊属性的支持"><span class="toc-number">15.1.</span> <span class="toc-text">一些特殊属性的支持</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#滑动中的值"><span class="toc-number">16.</span> <span class="toc-text">滑动中的值</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#canvas画图细节和技巧"><span class="toc-number">17.</span> <span class="toc-text">canvas画图细节和技巧</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#android-studio中的app的class文件目录"><span class="toc-number">18.</span> <span class="toc-text">android studio中的app的class文件目录</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#使用gradle打release包，不将密码放在build-gradle中"><span class="toc-number">19.</span> <span class="toc-text">使用gradle打release包，不将密码放在build.gradle中</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#RecyclerView-notify的注意点"><span class="toc-number">20.</span> <span class="toc-text">RecyclerView notify的注意点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ViewStub注意点"><span class="toc-number">21.</span> <span class="toc-text">ViewStub注意点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#intent传递数据的替代"><span class="toc-number">22.</span> <span class="toc-text">intent传递数据的替代</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ImageView加载不出来bitmap"><span class="toc-number">23.</span> <span class="toc-text">ImageView加载不出来bitmap</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Rxjava2-doOnxx方法"><span class="toc-number">24.</span> <span class="toc-text">Rxjava2 doOnxx方法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#获取manifest文件中组件中节点下的value数据"><span class="toc-number">25.</span> <span class="toc-text">获取manifest文件中组件中节点下的value数据</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#view的点击水波纹"><span class="toc-number">26.</span> <span class="toc-text">view的点击水波纹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#解决重复点击"><span class="toc-number">27.</span> <span class="toc-text">解决重复点击</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#实现双击事件"><span class="toc-number">28.</span> <span class="toc-text">实现双击事件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#判断键盘是否弹出"><span class="toc-number">29.</span> <span class="toc-text">判断键盘是否弹出</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ScrollView滑动到底部-顶部"><span class="toc-number">30.</span> <span class="toc-text">ScrollView滑动到底部/顶部</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#键盘弹出时需要将内容上顶"><span class="toc-number">31.</span> <span class="toc-text">键盘弹出时需要将内容上顶</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Dialog使用wrap-content"><span class="toc-number">32.</span> <span class="toc-text">Dialog使用wrap_content</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#minHeight和padding的关系"><span class="toc-number">33.</span> <span class="toc-text">minHeight和padding的关系</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#java内部类"><span class="toc-number">34.</span> <span class="toc-text">java内部类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#一个数一定时间内一个范围内变化"><span class="toc-number">35.</span> <span class="toc-text">一个数一定时间内一个范围内变化</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#TypeEvaluator和Interpolator"><span class="toc-number">36.</span> <span class="toc-text">TypeEvaluator和Interpolator</span></a></li></ol>
		
		</div>
		
		<h3 id="限制EditText输入的字数"><a href="#限制EditText输入的字数" class="headerlink" title="限制EditText输入的字数"></a>限制EditText输入的字数</h3><p>xml:</p>
<pre><code>&lt;FrameLayout
        android:layout_width=&quot;wrap_content&quot;
        android:layout_height=&quot;wrap_content&quot;&gt;

        &lt;EditText
            android:id=&quot;@+id/suggest_EditText&quot;
            android:layout_width=&quot;match_parent&quot;
            android:layout_height=&quot;170dp&quot;
            android:background=&quot;@color/white&quot;
            android:gravity=&quot;top&quot;
            android:hint=&quot;如果你对我们的应用有任何建议，或者在使用过程中遇到任何问题都可以告诉我们&quot;
            android:paddingLeft=&quot;14dp&quot;
            android:paddingRight=&quot;9dp&quot;
            android:paddingTop=&quot;18dp&quot;
            android:textColor=&quot;#9B9B9B&quot;
            android:textColorHint=&quot;#9B9B9B&quot;
            android:textSize=&quot;14sp&quot;/&gt;

        &lt;TextView
            android:id=&quot;@+id/tv_text_count&quot;
            android:layout_width=&quot;wrap_content&quot;
            android:layout_height=&quot;wrap_content&quot;
            android:layout_gravity=&quot;bottom|right&quot;
            android:layout_marginBottom=&quot;10dp&quot;
            android:layout_marginRight=&quot;38dp&quot;
            android:text=&quot;0&quot;/&gt;

        &lt;TextView
            android:layout_width=&quot;wrap_content&quot;
            android:layout_height=&quot;wrap_content&quot;
            android:layout_gravity=&quot;bottom|right&quot;
            android:layout_marginBottom=&quot;10dp&quot;
            android:layout_marginRight=&quot;10dp&quot;
            android:text=&quot;/ 74&quot;/&gt;
    &lt;/FrameLayout&gt;
</code></pre><p>java:</p>
<pre><code>  @ViewInject(R.id.suggest_EditText)
  private EditText suggest;
  @ViewInject(R.id.tv_text_count)
  private TextView input_count;
  private int maxInputCount = 74;

suggest.addTextChangedListener(new TextWatcher() {
        @Override
        public void beforeTextChanged(CharSequence s, int start, int count, int after) {

        }

        @Override
        public void onTextChanged(CharSequence s, int start, int before, int count) {

        }

        @Override
        public void afterTextChanged(Editable s) {
            int length = s.toString().length();
            if (length &lt;= maxInputCount) {
                input_count.setText(length + &quot;&quot;);
            } else {
                suggest.setText(s.toString().substring(0, maxInputCount));
                suggest.setSelection(maxInputCount);
            }
        }
    });
</code></pre><h3 id="EditText只接受数字，其余无法输入到EditText中"><a href="#EditText只接受数字，其余无法输入到EditText中" class="headerlink" title="EditText只接受数字，其余无法输入到EditText中"></a>EditText只接受数字，其余无法输入到EditText中</h3><ul>
<li><p>使用<code>android:digits</code>属性</p>
<p> android:digits=”1234567890”</p>
</li>
<li><p>java中设置<code>NumberKeyListener</code>监听</p>
<p> NumberKeyListener input = new NumberKeyListener() {</p>
<pre><code>     @Override
     public int getInputType() {
        //限制弹出的键盘类型
          return InputType.TYPE_CLASS_TEXT;
      }
     @Override
     protected char[] getAcceptedChars() {
        //字符过滤
          String limit = FILTER_PASSWORD;
         return limit.toCharArray();
      } }; 
etPassWord1.setKeyListener(input);
</code></pre></li>
</ul>
<h3 id="EditText修改Cursor颜色"><a href="#EditText修改Cursor颜色" class="headerlink" title="EditText修改Cursor颜色"></a>EditText修改Cursor颜色</h3><pre><code>android:textCursorDrawable=&quot;@drawable/cursor&quot;
</code></pre><h3 id="EditText密码输入框的可见与不可见切换"><a href="#EditText密码输入框的可见与不可见切换" class="headerlink" title="EditText密码输入框的可见与不可见切换"></a>EditText密码输入框的可见与不可见切换</h3><pre><code>&lt;EditText
     android:id=&quot;@+id/et_login_password&quot;
     android:layout_width=&quot;match_parent&quot;
     android:layout_height=&quot;wrap_content&quot;
     android:hint=&quot;请输入密码&quot;
     android:inputType=&quot;textPassword&quot;
     android:maxLength=&quot;18&quot;
     android:textSize=&quot;14sp&quot; /&gt;
</code></pre><p>点击图片切换可见与不可见状态：</p>
<pre><code>name_eyes.setOnClickListener(new View.OnClickListener() {
            @Override
            public void onClick(View v) {
                if (isHidden) {
                    //设置EditText文本为可见的
                    etPassWord.setTransformationMethod(HideReturnsTransformationMethod.getInstance());
                    name_eyes.setImageResource(R.drawable.inmage_eyes_on);
                } else {
                    //设置EditText文本为隐藏的
                    etPassWord.setTransformationMethod(PasswordTransformationMethod.getInstance());
                    name_eyes.setImageResource(R.drawable.inmage_eyes_off);
                }
                isHidden = !isHidden;
                etPassWord.postInvalidate();
                //切换后将EditText光标置于末尾
                CharSequence charSequence = etPassWord.getText();
                if (charSequence instanceof Spannable) {
                    Spannable spanText = (Spannable) charSequence;
                    Selection.setSelection(spanText, charSequence.length());
                }

            }
        });
</code></pre><h3 id="EditText属性设置"><a href="#EditText属性设置" class="headerlink" title="EditText属性设置"></a>EditText属性设置</h3><ul>
<li><p>隐藏光标</p>
<pre><code>android:cursorVisible=&quot;false&quot;
</code></pre></li>
<li><p>不需要下划线</p>
<pre><code>android:background=&quot;@null&quot;
</code></pre></li>
<li><p>静止复制粘贴</p>
<p> setLongClickable(false);</p>
<pre><code>setCustomSelectionActionModeCallback(new ActionMode.Callback() {
    @Override
    public boolean onCreateActionMode(ActionMode mode, Menu menu) {
        return false;
    }

    @Override
    public boolean onPrepareActionMode(ActionMode mode, Menu menu) {
        return false;
    }

    @Override
    public boolean onActionItemClicked(ActionMode mode, MenuItem item) {
        return false;
    }

    @Override
    public void onDestroyActionMode(ActionMode mode) {

    }
});
setImeOptions(EditorInfo.IME_FLAG_NO_EXTRACT_UI); // android:imeOptions=&quot;flagNoExtractUi&quot;

setOnTouchListener(new View.OnTouchListener() {
    @Override
    public boolean onTouch(View v, MotionEvent event) {
        if (event.getAction() == MotionEvent.ACTION_DOWN) {
            // setInsertionDisabled when user touches the view
            setInsertionDisabled(CardNumberInputView.this);
        }
        return false;
    }
});
</code></pre></li>
<li><p>自动弹出键盘</p>
<p>页面刚加载时，页面变化，导致键盘不会弹出，可以延迟一点后弹出键盘</p>
<pre><code>Timer timer = new Timer();
    timer.schedule(new TimerTask() {
        public void run() {
            InputMethodManager inputManager = (InputMethodManager) context.getSystemService(Context
                    .INPUT_METHOD_SERVICE);
            inputManager.showSoftInput(CardNumberInputView.this, 0);
        }
    }, 500);
</code></pre></li>
<li><p>始终隐藏键盘</p>
<p> mDateEditText.setInputType(InputType.TYPE_NULL);</p>
</li>
</ul>
<h3 id="android-windowSoftInputMode属性详解"><a href="#android-windowSoftInputMode属性详解" class="headerlink" title="android:windowSoftInputMode属性详解"></a>android:windowSoftInputMode属性详解</h3><ul>
<li>stateUnspecified：软键盘的状态并没有指定，系统将选择一个合适的状态或依赖于主题的设置</li>
<li>stateUnchanged：当这个activity出现时，软键盘将一直保持在上一个activity里的状态，无论是隐藏还是显示<br>stateHidden：用户选择activity时，软键盘总是被隐藏</li>
<li>stateAlwaysHidden：当该Activity主窗口获取焦点时，软键盘也总是被隐藏的</li>
<li>stateVisible：软键盘通常是可见的</li>
<li>stateAlwaysVisible：用户选择activity时，软键盘总是显示的状态</li>
<li>adjustUnspecified：默认设置，通常由系统自行决定是隐藏还是显示</li>
<li>adjustResize：该Activity总是调整屏幕的大小以便留出软键盘的空间</li>
<li>adjustPan：当前窗口的内容将自动移动以便当前焦点从不被键盘覆盖和用户能总是看到输入内容的部分</li>
</ul>
<h3 id="Android-MarginLeft与MarginStart的区别"><a href="#Android-MarginLeft与MarginStart的区别" class="headerlink" title="Android MarginLeft与MarginStart的区别"></a>Android MarginLeft与MarginStart的区别</h3><p>根据api注释，我们得知MarginStart指的是控件距离开头View部分的间距大小，MarginLeft则指的是控件距离左边View部分的间距大小，MarginEnd和MarginRight同理。</p>
<p>For left-to-right flow, start=left, end=right.</p>
<p>For right-to-left flow, start=right, end=left.</p>
<p>Android4.2开始支持RTL(Right To Left)布局，兼容阿拉伯等地区从右向左书写习惯，在api 17以上，使用start/end为佳。</p>
<p>实例：</p>
<pre><code>&lt;Button
    android:id=&quot;@+id/1&quot;
    style=&quot;?android:attr/borderlessButtonStyle&quot;
    android:layout_width=&quot;wrap_content&quot;
    android:layout_height=&quot;wrap_content&quot;
    android:layout_alignParentLeft=&quot;true&quot;
    android:layout_below=&quot;@id/tv_item_oil_staff_head_title_under_line2&quot;
    android:background=&quot;@drawable/btn_orange_radius_border_white_background&quot;
    android:paddingBottom=&quot;10dp&quot;
    android:paddingLeft=&quot;40dp&quot;
    android:paddingRight=&quot;40dp&quot;
    android:paddingTop=&quot;10dp&quot;
    android:text=&quot;编辑&quot;
    android:textColor=&quot;@color/colourEssential&quot;
    android:textSize=&quot;14sp&quot;
    app:layout_marginStartPercent=&quot;8%&quot;/&gt;

&lt;Button
    android:id=&quot;@+id/btn2&quot;
    style=&quot;?android:attr/borderlessButtonStyle&quot;
    android:layout_width=&quot;wrap_content&quot;
    android:layout_height=&quot;wrap_content&quot;
    android:layout_below=&quot;@id/tv_item_oil_staff_head_title_under_line2&quot;
    android:layout_toRightOf=&quot;@id/btn1&quot;
    android:background=&quot;@drawable/btn_gray_border_gray_background&quot;
    android:paddingBottom=&quot;10dp&quot;
    android:paddingLeft=&quot;40dp&quot;
    android:paddingRight=&quot;40dp&quot;
    android:paddingTop=&quot;10dp&quot;
    android:text=&quot;禁用&quot;
    android:textColor=&quot;@color/white&quot;
    android:textSize=&quot;14sp&quot;
    app:layout_marginStartPercent=&quot;13%&quot;/&gt;
</code></pre><p>首先开始使用的<code>layout_marginLeftPercent</code>,部分手机上按钮点击后，marginLeft会失效，改为<code>layout_marginStartPercent</code>就没问题了。</p>
<h3 id="Fragment数据懒加载"><a href="#Fragment数据懒加载" class="headerlink" title="Fragment数据懒加载"></a>Fragment数据懒加载</h3><p>activity中嵌套fragment，默认会缓存两个fragment，那么要是fragment中有网络请求等，就会网络丢包或者网络堵塞等问题，那么就要在fragment可见时才进行网络请求等加载数据，实现fragment的懒加载</p>
<p>fragment中提供<code>setUserVisibleHint（boolean isVisibleToUser）</code>方法，只有在fragment可见时isVisibleToUser会为true,此时可以做网络请求的操作</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUserVisibleHint</span><span class="params">(<span class="keyword">boolean</span> isVisibleToUser)</span> </span>&#123;</span><br><span class="line">    Log.d(<span class="string">"TAG"</span>, mTagName + <span class="string">" setUserVisibleHint() --&gt; isVisibleToUser = "</span> + isVisibleToUser);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (isVisibleToUser) &#123;</span><br><span class="line">        pullData();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">super</span>.setUserVisibleHint(isVisibleToUser);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>但是<code>setUserVisibleHint</code>方法早于onCreate方法，此时不能进行UI更新操作，对于网络数据后需要更新UI不适用。fragment中提供<code>getUserVisibleHint()</code>，在onStart()可以获取到这个返回时，就可以进行网络操作和UI操作了</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onStart</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">super</span>.onStart();</span><br><span class="line">    Log.d(<span class="string">"TAG"</span>, mTagName + <span class="string">" onStart()"</span>);</span><br><span class="line"></span><br><span class="line">    ...</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(getUserVisibleHint()) &#123;</span><br><span class="line">        pullData();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="ScrollView嵌套LinearLayout-LinearLayout不铺满屏幕问题"><a href="#ScrollView嵌套LinearLayout-LinearLayout不铺满屏幕问题" class="headerlink" title="ScrollView嵌套LinearLayout,LinearLayout不铺满屏幕问题"></a>ScrollView嵌套LinearLayout,LinearLayout不铺满屏幕问题</h3><p>当ScrollView嵌套LinearLayout，都是match_parent时，LinearLayout不铺满屏幕，可以在ScrollView中添加<code>android:fillViewport=&quot;true&quot;</code>,此时就会铺满屏幕了</p>
<h3 id="RecyclerView使用注意"><a href="#RecyclerView使用注意" class="headerlink" title="RecyclerView使用注意"></a>RecyclerView使用注意</h3><ul>
<li>findViewByPosition(0)得到null的问题</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">View view = recyclerView.getLayoutManager().findViewByPosition(postion);</span><br></pre></td></tr></table></figure>
<p>此刻得到的view为null,因为recyclerView加载数据不会立刻更新完视图，所以在得到view的时候可能未完全加载完毕，得到的对象就是null的。</p>
<ul>
<li>使用<code>recyclerView.getViewTreeObserver().addOnGlobalLayoutListener</code>,在<code>onGlobalLayout</code>中获得view为null</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">recyclerView.getViewTreeObserver().addOnGlobalLayoutListener(<span class="keyword">new</span> ViewTreeObserver.OnGlobalLayoutListener() &#123;</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onGlobalLayout</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    recyclerView.getViewTreeObserver().removeOnGlobalLayoutListener(<span class="keyword">this</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">int</span> itemCount = mAdapter.getItemCount();</span><br><span class="line">    View view = recyclerView.getLayoutManager().findViewByPosition(<span class="number">0</span>);</span><br><span class="line">    RecyclerView.ViewHolder viewHolder = recyclerView.findViewHolderForPosition(itemCount - <span class="number">1</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (view != <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">int</span> height = view.getHeight();</span><br><span class="line">        totalHeight[<span class="number">0</span>] += height * (itemCount - <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">if</span> (screenHeight &gt; totalHeight[<span class="number">0</span>]) &#123;</span><br><span class="line">            tv_about_card.setVisibility(View.VISIBLE);</span><br><span class="line">            <span class="keyword">if</span> (viewHolder != <span class="keyword">null</span>) &#123;</span><br><span class="line">                viewHolder.itemView.setVisibility(View.GONE);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            tv_about_card.setVisibility(View.GONE);</span><br><span class="line">            <span class="keyword">if</span> (viewHolder != <span class="keyword">null</span>) &#123;</span><br><span class="line">                viewHolder.itemView.setVisibility(View.VISIBLE);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>因为<code>onGlobalLayout</code>会被系统多次调用<br>onGlobalLayout can be called multiple times. Some of those calls can happen even before Layout is ready (and by ready I mean the moment when you can get dimensions of a View by calling view.getHeight() or view.getWidth()).<br>所以需要添加得到的view的非空判断才行</p>
<ul>
<li><p>findViewHolderForAdapterPosition和findViewHolderForLayoutPosition和findViewHolderForPosition的区别</p>
<ul>
<li><p>findViewHolderForAdapterPosition</p>
<p>适配器位置：从适配器的角度看，条目在是适配器中的位置。</p>
<p><strong>在notifyDataSetChange()方法被调用和新布局还没有被计算之前是不能使用的</strong>。鉴于这个原因，你应该小心的去处理这些方法有可能返回NO_POSITION或者null的情况。</p>
</li>
<li><p>findViewHolderForLayoutPosition</p>
<p>布局位置：从LayoutManager的角度看，条目在最新布局计算中的位置。</p>
<p>这些positions包括从最近一次布局计算的所有改变。你可以根据这些位置来方便的得到<strong>用户当前从屏幕上所看到</strong>的。所item还不可见，那么可能返回NO_POSITION或者null。</p>
</li>
<li><p>findViewHolderForPosition</p>
</li>
</ul>
<p><strong>在notifyDataSetChange会改变adapter</strong></p>
</li>
<li><p>viewHolder.getAdapterPosition和viewHolder.getLayoutPosition的区别</p>
<p>区别就是adapter和layout的位置会有时间差(&lt;16ms), 如果你改变了Adapter的数据然后刷新视图, layout需要过一段时间才会更新视图, 在这段时间里面, 这两个方法返回的position会不一样.</p>
<p>在notifyDataSetChanged之后并不能马上获取Adapter中的position, 要等布局结束之后才能获取到.<br>而对于Layout的position, 在notifyItemInserted之后, Layout不能马上获取到新的position, 因为布局还没更新(需要&lt;16ms的时间刷新视图), 所以只能获取到旧的, 但是Adapter中的position就可以马上获取到最新的position.</p>
</li>
</ul>
<p>也就说：layout相关的保存的是当前可见item的信息，adapter保存的是所有item的信息</p>
<h3 id="实现嵌套滑动"><a href="#实现嵌套滑动" class="headerlink" title="实现嵌套滑动"></a>实现嵌套滑动</h3><p><img src="http://p2qa028as.bkt.clouddn.com/blog/180125/EFHHHh9CLf.png?imageslim" alt="mark"></p>
<p>实现了NestedScrollingChild接口的子View发送事件，给外面实现了NestedScrollingParent的View发事件，再传递给Behacior子类绑定的view，就实现了嵌套滑动</p>
<p>如：NestedScrollView直接会发送事件，CoordinatorLayout也就是外面parent的会自动接收，需要写一个Behavior子类来消费即可</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">RelativeLayout</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></span></span><br><span class="line"><span class="tag"><span class="attr">xmlns:app</span>=<span class="string">"http://schemas.android.com/apk/res-auto"</span></span></span><br><span class="line"><span class="tag"><span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag"><span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">android.support.design.widget.CoordinatorLayout</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">android.support.v4.widget.NestedScrollView</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">"@+id/ns0"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">"150dp"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_gravity</span>=<span class="string">"top|right"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:background</span>=<span class="string">"#666666"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">TextView</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">style</span>=<span class="string">"@style/TextAppearance.AppCompat.Display3"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:text</span>=<span class="string">"A\nB\nC\nD\nE\nF\nG\nH\nI\nJ\nK\nL\nM\nN\nO\nP\nQ\nR\nS\nT\nU\nV\nW\nX\nY\nZ"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">android.support.v4.widget.NestedScrollView</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">android.support.v4.widget.NestedScrollView</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">"@+id/ns1"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">"150dp"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_gravity</span>=<span class="string">"top|left"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:background</span>=<span class="string">"#888888"</span></span></span><br><span class="line">     	&lt;!--消费传递的事件 --&gt;   </span><br><span class="line">		app:layout_behavior="com.aohuan.dodo.coordinator.utils.DodoBehavior1scroll"&gt;</span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">TextView</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">style</span>=<span class="string">"@style/TextAppearance.AppCompat.Display3"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:text</span>=<span class="string">"A\nB\nC\nD\nE\nF\nG\nH\nI\nJ\nK\nL\nM\nN\nO\nP\nQ\nR\nS\nT\nU\nV\nW\nX\nY\nZ"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">android.support.v4.widget.NestedScrollView</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">android.support.design.widget.CoordinatorLayout</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">RelativeLayout</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>参考： <a href="http://www.jianshu.com/p/f267fdbda794" target="_blank" rel="noopener">http://www.jianshu.com/p/f267fdbda794</a></p>
<p>###Android studio的使用技巧</p>
<ul>
<li><p>使用Configure Image Asset</p>
</li>
<li><p>使用Configure Vector Asset</p>
</li>
<li><p>xml中的技巧</p>
<ul>
<li><p>tools，在view中使用<code>tools:</code>代替<code>android:</code></p>
<p>使用tools代替android:,这样设置的属性只会在界面预览的时候出现，在编译运行后不会出现</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tools:text="this is tools"</span><br></pre></td></tr></table></figure>
</li>
<li><p>在根布局使用<code>tools:context</code></p>
<p>在跟布局中加上指定<code>tool:context</code>,就可以点击跳转到使用到的context类中；也可以快捷修复指定的onClick属性，在对应类中创建onClick事件</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tools:context=".MainActivity"</span><br></pre></td></tr></table></figure>
<ul>
<li>在recyclerview/listview中使用<code>tools:listitem</code></li>
</ul>
<p><code>tools:listitem=&quot;@layout/item_layout&quot;</code>,可以在listView/Recyclerview中显示item的布局</p>
<p>在使用recyclerview时可以配合<code>app:layoutManager=&quot;GridLayoutManager&quot;</code>指定布局管理器，<code>app:spanCount=&quot;2&quot;</code>指定几列显示</p>
</li>
</ul>
</li>
<li><p>加快编译速度</p>
<ul>
<li>配置productFlavors,指定dev和prod,在dev中指定minSdkVersion为21或以上</li>
</ul>
<figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">productFlavors &#123;</span><br><span class="line">    dev &#123;</span><br><span class="line">	<span class="comment">//api21以上默认使用的是art，dex没有64K限制</span></span><br><span class="line">      minSdkVersion <span class="number">21</span></span><br><span class="line">	<span class="comment">//指定dev版本的app versionName添加后缀</span></span><br><span class="line">      versionNameSuffix <span class="string">"-dev"</span></span><br><span class="line">	<span class="comment">//applicationId添加后缀</span></span><br><span class="line">      applicationIdSuffix <span class="string">'.dev'</span></span><br><span class="line">      ...</span><br><span class="line">    &#125;</span><br><span class="line">	<span class="comment">//即使使用默认的配置也需要写出prod</span></span><br><span class="line">    prod &#123;</span><br><span class="line">      ...</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>只编译部分需要的资源</li>
</ul>
<figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">productFlavors &#123;</span><br><span class="line">dev &#123;</span><br><span class="line">  ...</span><br><span class="line">  <span class="comment">// The following configuration limits the "dev" flavor to using</span></span><br><span class="line">  <span class="comment">// English stringresources and xxhdpi screen-density resources.</span></span><br><span class="line">  resConfigs <span class="string">"en"</span>, <span class="string">"xxhdpi"</span></span><br><span class="line">&#125;</span><br><span class="line">...</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>使用静态编译配置</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">int MILLIS_IN_MINUTE = 1000 * 60</span><br><span class="line">int minutesSinceEpoch = System.currentTimeMillis() / MILLIS_IN_MINUTE</span><br><span class="line"></span><br><span class="line">android &#123;</span><br><span class="line">    ...gradle</span><br><span class="line">    defaultConfig &#123;</span><br><span class="line">        // Making either of these two values dynamic in the defaultConfig will</span><br><span class="line">        // require a full APK build and reinstallation because the AndroidManifest.xml</span><br><span class="line">        // must be updated (which is not supported by Instant Run).</span><br><span class="line">        versionCode 1</span><br><span class="line">        versionName &quot;1.0&quot;</span><br><span class="line">        ...</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // The defaultConfig values above are fixed, so your incremental builds don&apos;t</span><br><span class="line">    // need to rebuild the manifest (and therefore the whole APK, slowing build times).</span><br><span class="line">    // But for release builds, it&apos;s okay. So the following script iterates through</span><br><span class="line">    // all the known variants, finds those that are &quot;release&quot; build types, and</span><br><span class="line">    // changes those properties to something dynamic.</span><br><span class="line">    applicationVariants.all &#123; variant -&gt;</span><br><span class="line">        if (variant.buildType.name == &quot;release&quot;) &#123;</span><br><span class="line">            variant.mergedFlavor.versionCode = minutesSinceEpoch;</span><br><span class="line">            variant.mergedFlavor.versionName = minutesSinceEpoch + &quot;-&quot; + variant.flavorName;</span><br><span class="line">        &#125;</span><br><span class="line">     &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><p>使用静态以来版本</p>
<p>不要使用<code>com.android.tools.build:gradle:2.+</code>待+,这样需要编译时动态加载</p>
</li>
<li><p>打开offline mode</p>
<p>网速慢时就会加载离线gradle，而不会一直等待现在的资源下载完毕</p>
</li>
<li><p>打开Instant Run</p>
</li>
</ul>
</li>
<li><p>配置Build Variant</p>
<ul>
<li>配置buid type</li>
</ul>
<p>如果希望添加或更改特定设置，您可以将调试构建类型添加到您的配置中。以下示例为调试构建类型指定了 applicationIdSuffix，并配置了一个使用调试构建类型中的设置进行初始化的“jnidebug”构建类型。</p>
<pre><code>​<figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">buildTypes &#123;</span><br><span class="line">    release &#123;</span><br><span class="line">        minifyEnabled <span class="keyword">true</span></span><br><span class="line">        proguardFiles getDefaultProguardFile(<span class="string">'proguard-android.txt'</span>), <span class="string">'proguard-rules.pro'</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    debug &#123;</span><br><span class="line">        applicationIdSuffix <span class="string">".debug"</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * The 'initWith' property allows you to copy configurations from other build types,</span></span><br><span class="line"><span class="comment">     * so you don't have to configure one from the beginning. You can then configure</span></span><br><span class="line"><span class="comment">     * just the settings you want to change. The following line initializes</span></span><br><span class="line"><span class="comment">     * 'jnidebug' using the debug build type, and changes only the</span></span><br><span class="line"><span class="comment">     * applicationIdSuffix and versionNameSuffix settings.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"></span><br><span class="line">    jnidebug &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// This copies the debuggable attribute and debug signing configurations.</span></span><br><span class="line">        initWith debug</span><br><span class="line"></span><br><span class="line">        applicationIdSuffix <span class="string">".jnidebug"</span></span><br><span class="line">        jniDebuggable <span class="keyword">true</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">​</span><br></pre></td></tr></table></figure>
</code></pre><ul>
<li><p>配置productFlavor</p>
<ul>
<li><p>创建产品风味与创建构建类型类似：只需将它们添加到 productFlavors {} 代码块并配置您想要的设置。产品风味支持与 defaultConfig 相同的属性，这是因为 defaultConfig 实际上属于 ProductFlavor 类。这意味着，您可以在 defaultConfig {} 代码块中提供所有风味的基本配置，每种风味均可更改任何这些默认值</p>
<figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">android &#123;</span><br><span class="line">	...</span><br><span class="line">	defaultConfig &#123;...&#125;</span><br><span class="line">	buildTypes &#123;...&#125;</span><br><span class="line">	productFlavors &#123;</span><br><span class="line">	    demo &#123;</span><br><span class="line">	        applicationIdSuffix <span class="string">".demo"</span></span><br><span class="line">	        versionNameSuffix <span class="string">"-demo"</span></span><br><span class="line">	    &#125;</span><br><span class="line">	    full &#123;</span><br><span class="line">	        applicationIdSuffix <span class="string">".full"</span></span><br><span class="line">	        versionNameSuffix <span class="string">"-full"</span></span><br><span class="line">	    &#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>上面就会配置demo和full两个不通过的app属性，其中给applicationId和versionName添加后缀</p>
</li>
<li><p>不同的flavor可以组合，可以使用flavorDimensions定义不同的维度后进行组合</p>
<figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"> 	 flavorDimensions <span class="string">"stage"</span>, <span class="string">"mode"</span></span><br><span class="line"> productFlavors &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//指定不同的配置，会build配置的app，并覆盖defaultConfig中对应的属性</span></span><br><span class="line">    free &#123;</span><br><span class="line">        dimension <span class="string">"stage"</span></span><br><span class="line">        applicationIdSuffix <span class="string">'.free'</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    paid &#123;</span><br><span class="line">        dimension <span class="string">"mode"</span></span><br><span class="line">        applicationIdSuffix <span class="string">'.paid'</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    dev &#123;</span><br><span class="line">        dimension <span class="string">"stage"</span></span><br><span class="line">        minSdkVersion <span class="number">21</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    prod &#123;</span><br><span class="line">        dimension <span class="string">"mode"</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>构建变体：[free,dev][paid, prod][Debug, Release]<br>对应 APK：app-[free, dev]-[paid, prod]-[debug, release].apk</p>
<p>一共可以得到的apk数量为 flavorDimensions的数量 <em> 构建类型的数量</em>2（debug,release）<br>上述就会有2<em>2</em>2八个变体<br>所有的变体列表可以在Build&gt;select build variant中查看到</p>
</li>
</ul>
</li>
<li><p>过滤变体</p>
</li>
</ul>
</li>
</ul>
<pre><code>有些变体是无意义的，所以可以过滤掉，可以使用可以使用 `variantFilter {}` 代码块过滤出组合


      <figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">android &#123;</span><br><span class="line">  ...</span><br><span class="line">  buildTypes &#123;...&#125;</span><br><span class="line"></span><br><span class="line">  flavorDimensions <span class="string">"api"</span>, <span class="string">"mode"</span></span><br><span class="line">  productFlavors &#123;</span><br><span class="line">    free &#123;...&#125;</span><br><span class="line">    paid &#123;...&#125;</span><br><span class="line">    dev &#123;...&#125;</span><br><span class="line">    prod &#123;...&#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  variantFilter &#123; variant -&gt;</span><br><span class="line">      <span class="keyword">def</span> names = variant.flavors*.name</span><br><span class="line">      <span class="comment">// To check for a certain build type, use variant.buildType.name == "&lt;buildType&gt;"</span></span><br><span class="line">      <span class="keyword">if</span> (names.contains(<span class="string">"minApi21"</span>) &amp;&amp; names.contains(<span class="string">"demo"</span>)) &#123;</span><br><span class="line">          <span class="comment">// Gradle ignores any variants that satisfy the conditions above.</span></span><br><span class="line">          setIgnore(<span class="keyword">true</span>)</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

      菜单栏中的 Build &gt; Select Build Variant（或工具窗口栏中的 Build Variants）时，过滤的变体不会再出现
</code></pre><ul>
<li><p>创建不同的目录</p>
<p>android studio再默认情况下会创建main目录，也可以通过gradle创建新的针对不同falvor的储存特殊资源的目录。例如，您可以在 main/ 源集中定义基本的功能，使用productFlavor源集针对不同的客户更改应用的品牌，或者仅针对使用调试构建类型的构建变体包含特殊的权限和日志记录功能。</p>
<ul>
<li><p>创建java文件夹</p>
<ol>
<li>打开 Project 窗格并从窗格顶端的下拉菜单中选择 Project 视图。</li>
<li>导航至 MyProject/app/src/。</li>
<li>右键点击 src 目录并选择 New &gt; Folder &gt; Java Folder。</li>
<li>从 Target Source Set 旁边的下拉菜单中，选择 debug。</li>
<li>点击 Finish。</li>
</ol>
</li>
<li><p>创建res文件夹</p>
<ol>
<li>在相同的 Project 窗格中，右键点击 src 目录并选择 New &gt; XML &gt; Values XML File。</li>
<li>为 XML 文件输入名称或保留默认名称。</li>
<li>从 Target Source Set 旁边的下拉菜单中，选择 debug。</li>
<li>点击 Finish。</li>
</ol>
</li>
</ul>
<p>如上操作，可以针对不同的productFlavor创建不同的文件夹</p>
</li>
<li><p>更改默认的资源配置位置</p>
<p>可以使用 sourceSets {} 代码块更改 Gradle 希望为源集的每个组件收集文件的位置。您不需要重新定位文件；只需要为 Gradle 提供相对于模块级 build.gradle 文件的路径，Gradle 应当可以在此路径下为每个源集组件找到文件</p>
<p>下面的代码示例可以将 app/other/ 目录中的源映射到 main 源集的某些组件，并更改 androidTest 源集的根目录。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">android &#123;</span><br><span class="line">  ...</span><br><span class="line">  sourceSets &#123;</span><br><span class="line">    // Encapsulates configurations for the main source set.</span><br><span class="line">    main &#123;</span><br><span class="line">      // Changes the directory for Java sources. The default directory is</span><br><span class="line">      // &apos;src/main/java&apos;.</span><br><span class="line">      java.srcDirs = [&apos;other/java&apos;]</span><br><span class="line"></span><br><span class="line">      // If you list multiple directories, Gradle uses all of them to collect</span><br><span class="line">      // sources. Because Gradle gives these directories equal priority, if</span><br><span class="line">      // you define the same resource in more than one directory, you get an</span><br><span class="line">      // error when merging resources. The default directory is &apos;src/main/res&apos;.</span><br><span class="line">      res.srcDirs = [&apos;other/res1&apos;, &apos;other/res2&apos;]</span><br><span class="line"></span><br><span class="line">      // Note: You should avoid specifying a directory which is a parent to one</span><br><span class="line">      // or more other directories you specify. For example, avoid the following:</span><br><span class="line">      // res.srcDirs = [&apos;other/res1&apos;, &apos;other/res1/layouts&apos;, &apos;other/res1/strings&apos;]</span><br><span class="line">      // You should specify either only the root &apos;other/res1&apos; directory, or only the</span><br><span class="line">      // nested &apos;other/res1/layouts&apos; and &apos;other/res1/strings&apos; directories.</span><br><span class="line"></span><br><span class="line">      // For each source set, you can specify only one Android manifest.</span><br><span class="line">      // By default, Android Studio creates a manifest for your main source</span><br><span class="line">      // set in the src/main/ directory.</span><br><span class="line">      manifest.srcFile &apos;other/AndroidManifest.xml&apos;</span><br><span class="line">      ...</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // Create additional blocks to configure other source sets.</span><br><span class="line">    androidTest &#123;</span><br><span class="line"></span><br><span class="line">      // If all the files for a source set are located under a single root</span><br><span class="line">      // directory, you can specify that directory using the setRoot property.</span><br><span class="line">      // When gathering sources for the source set, Gradle looks only in locations</span><br><span class="line">      // relative to the root directory you specify. For example, after applying the</span><br><span class="line">      // configuration below for the androidTest source set, Gradle looks for Java</span><br><span class="line">      // sources only in the src/tests/java/ directory.</span><br><span class="line">      setRoot &apos;src/tests&apos;</span><br><span class="line">      ...</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
</li>
<li><p>创建sourceSets</p>
<p>在gradle中指定productFlavor，可以快捷创建指定的sourceSets</p>
<p>步骤：</p>
<ol>
<li>打开 Project 窗格并从窗格顶端的下拉菜单中选择 Project 视图。</li>
<li>导航至 MyProject/app/src/。</li>
<li>右键点击 src 目录并选择 <strong>New &gt; Folder &gt; Java Folder</strong>。</li>
<li>从 Target Source Set 旁边的下拉菜单中，选择 debug。<br>点击 Finish。</li>
</ol>
<p><strong>注意：</strong></p>
<p>对于给定的构建变体，如果找到两个或两个以上定义同一 Java 类的源集目录，Gradle 就会引发一个构建错误。例如，在构建调试 APK 时，您不能同时定义 src/debug/Utility.java 和 src/main/Utility.java。这是因为 Gradle 会在构建过程中检查这两个目录并引发“duplicate class”错误。如果针对不同的构建类型需要不同版本的 Utility.java，可以让每个构建类型定义其自己的文件版本，而不将其包含在 main/ 源集中。</p>
<p><img src="http://p2qa028as.bkt.clouddn.com/blog/180125/I01gHjh9gI.png?imageslim" alt="mark"></p>
</li>
<li><p>创建不同屏幕和不同架构的apk</p>
<figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//根据屏幕尺寸和不同架构平台bulid多apk</span></span><br><span class="line">    splits &#123;</span><br><span class="line">        density &#123;</span><br><span class="line">            enable <span class="keyword">true</span></span><br><span class="line">            reset()</span><br><span class="line">            <span class="keyword">include</span> <span class="string">"mdpi"</span>,<span class="string">"xmdpi"</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        abi&#123;</span><br><span class="line">            enable <span class="keyword">true</span></span><br><span class="line">            reset()</span><br><span class="line">            <span class="keyword">include</span> <span class="string">"x86"</span>,<span class="string">"arm"</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p><strong>splits和productFlavors的区别</strong></p>
<ul>
<li>splits: 根据不同的屏幕密度和abi build apk</li>
<li>productFlavors :If you need to create different versions of your app that are not based on screen density or ABI, you can instead use build variants.<em>**</em></li>
</ul>
</li>
<li><p>manifest的合并</p>
<p>APK 文件只能包含一个 AndroidManifest.xml 文件，但 Android Studio 项目可以包含多个文件（通过主源集、构建变体和导入的库提供）。因此，在构建应用时，Gradle 构建会将所有清单文件合并到一个封装到 APK 的清单文件中。</p>
<p><strong>属性值的默认合并行为</strong></p>
<p>|高优先级属性    |低优先级属性    |属性的合并结果<br>|———-|———–|————<br>|没有值     |没有值       |没有值（使用默认值）<br>|没有值       |值 B           |值 B<br>|值 A       |没有值       |值 A<br>|值 A       |值 A           |值 A<br>|值 A       |值 B        |冲突错误—必须添加一个合并规则标记</p>
<p> 出现合并冲突就需要定义合并规则，通过合并规则标记</p>
<p> <a href="https://developer.android.google.cn/studio/build/manifest-merge.html" target="_blank" rel="noopener">manifest合并</a></p>
</li>
<li><p>向AndroidManifest文件中注入值</p>
<figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">android &#123;</span><br><span class="line">    defaultConfig &#123;</span><br><span class="line">        manifestPlaceholders = [hostName:<span class="string">"www.example.com"</span>]</span><br><span class="line">    &#125;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">intent-filter</span> <span class="attr">...</span> &gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">data</span> <span class="attr">android:scheme</span>=<span class="string">"http"</span> <span class="attr">android:host</span>=<span class="string">"$&#123;hostName&#125;"</span> <span class="attr">...</span> /&gt;</span></span><br><span class="line">    ...</span><br><span class="line"><span class="tag">&lt;/<span class="name">intent-filter</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>onTouchEvent判断滑动坐标<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">int</span> lastX = -<span class="number">1</span>;</span><br><span class="line"><span class="keyword">int</span> lastY = -<span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onTouchEvent</span><span class="params">(MotionEvent ev)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> action = ev.getAction();</span><br><span class="line">    <span class="comment">//检测到触摸事件后 第一时间得到相对于父控件的触摸点坐标 并赋值给x,y</span></span><br><span class="line">    <span class="keyword">int</span> x = (<span class="keyword">int</span>) ev.getX();</span><br><span class="line">    <span class="keyword">int</span> y = (<span class="keyword">int</span>) ev.getY();</span><br><span class="line">    <span class="keyword">switch</span> (action) &#123;</span><br><span class="line">        <span class="keyword">case</span> MotionEvent.ACTION_DOWN:</span><br><span class="line">            <span class="comment">//触摸事件中绕不开的第一步，必然执行，将按下时的触摸点坐标赋值给 lastX 和 last Y</span></span><br><span class="line">            lastX = x;</span><br><span class="line">            lastY = y;</span><br><span class="line">            Log.d(<span class="string">"MyScrollView"</span>, <span class="string">"last x:"</span> + x);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> MotionEvent.ACTION_MOVE:</span><br><span class="line">            <span class="comment">//触摸事件的第二步，这时候的x,y已经随着滑动操作产生了变化，用变化后的坐标减去首次触摸时的坐标得到 相对的偏移量</span></span><br><span class="line">            Log.d(<span class="string">"MyScrollView"</span>, <span class="string">"now x:"</span> + x);</span><br><span class="line">            Log.d(<span class="string">"MyScrollView"</span>, <span class="string">"x - lastX:"</span> + (x - lastX));</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> MotionEvent.ACTION_UP:</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">super</span>.onTouchEvent(ev);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="java继承细节"><a href="#java继承细节" class="headerlink" title="java继承细节"></a>java继承细节</h3><p>当父类有多个构造函数时，子类只需实现其中一个构造函数即可，或者在空参构造函数中super（params）有参的构造函数也可以</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Fu1</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Fu1</span><span class="params">(String name)</span></span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Fu1</span><span class="params">(String name,<span class="keyword">int</span> age)</span></span>&#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>第一种：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Zi</span> <span class="keyword">extends</span> <span class="title">Fu1</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Zi</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(name);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>第二种：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Zi</span> <span class="keyword">extends</span> <span class="title">Fu1</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Zi</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(<span class="keyword">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="ScrollView监听滑动到底部和顶部"><a href="#ScrollView监听滑动到底部和顶部" class="headerlink" title="ScrollView监听滑动到底部和顶部"></a>ScrollView监听滑动到底部和顶部</h3><p>通过自定义ScrollView,复写<code>onScrollChanged</code>方法，<code>onScrollChanged</code>会在滑动时实时调用，可以通过判断ScrollView子view的高度和滑动高度判断是否有滑动到顶部或者底部</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LoadMoreScrollView</span> <span class="keyword">extends</span> <span class="title">ScrollView</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> flag = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">private</span> OnScrollToBottomListener onScrollToBottom;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">LoadMoreScrollView</span><span class="params">(Context context)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(context);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">LoadMoreScrollView</span><span class="params">(Context context, AttributeSet attrs)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(context, attrs);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 数据加载完毕，将并发控制符置为0</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">loadingComponent</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        flag = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 滑动到了底部/顶部，但是由于scrollView的回弹效果，还是会被继续重复调用多次</span></span><br><span class="line"><span class="comment">     * 那么需要过滤操作</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> l</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> t</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> oldl</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> oldt</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onScrollChanged</span><span class="params">(<span class="keyword">int</span> l, <span class="keyword">int</span> t, <span class="keyword">int</span> oldl, <span class="keyword">int</span> oldt)</span> </span>&#123;</span><br><span class="line">		<span class="comment">//scrollView只会有一个子view</span></span><br><span class="line">        View child = getChildAt(<span class="number">0</span>);</span><br><span class="line">        <span class="keyword">if</span>(getScrollY()&lt;=<span class="number">0</span>)&#123;</span><br><span class="line">            LogUtils.d(<span class="string">"scroll to top"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (child.getMeasuredHeight() == getHeight() + getScrollY() &amp;&amp; flag == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (onScrollToBottom != <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="comment">//一进来就将并发控制符置为1，虽然onScrollChanged执行多次，但是由于并发控制符的值为1，不满足条件就不会执行到这</span></span><br><span class="line">                flag = <span class="number">1</span>;</span><br><span class="line">                onScrollToBottom.onScrollBottomListener(<span class="keyword">true</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (onScrollToBottom != <span class="keyword">null</span>) &#123;</span><br><span class="line">                onScrollToBottom.onScrollBottomListener(<span class="keyword">false</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 到达底部的回调</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setOnScrollToBottomListener</span><span class="params">(OnScrollToBottomListener listener)</span> </span>&#123;</span><br><span class="line">        onScrollToBottom = listener;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">OnScrollToBottomListener</span> </span>&#123;</span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">onScrollBottomListener</span><span class="params">(<span class="keyword">boolean</span> isBottom)</span></span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>注意：ScrollView在到达底部或者顶部时会有回弹效果，到达底部或者顶部的回调会执行多次，必须进行过滤才行</p>
<h3 id="属性动画"><a href="#属性动画" class="headerlink" title="属性动画"></a>属性动画</h3><p>只要带有<code>Property</code>单词的都属于属性动画，分为    <code>ViewPropertyAnimator</code>和<code>ObjectAnimator</code>（<code>ValueAnimator</code>为<code>ObjectAnimator</code>的父类）</p>
<ul>
<li><p>操作方式</p>
<ul>
<li><p>ViewPropertyAnimator</p>
<p>属于对view的快捷操作，通过view.animate().xx()就可以执行动画</p>
</li>
<li><p>ObjectAnimator</p>
<p>对有setter和getter方法的属性都可以进行操作进行动画，需要ObjectAnimator.ofXXX()创建后start</p>
</li>
</ul>
</li>
<li><p>添加监听</p>
<ul>
<li><p>ViewPropertyAnimator</p>
<ul>
<li>setListener</li>
<li>setUpdateListener  //当动画的属性更新时的监听</li>
<li>withStartAction  // 一次性的动画开始监听</li>
<li>withEndAction    // 一次性的动画结束监听</li>
</ul>
</li>
<li><p>ObjectAnimator</p>
<ul>
<li>addListener</li>
<li>addUpdateListener</li>
<li>addPauseListener  </li>
</ul>
</li>
</ul>
</li>
<li><p>多动画配合执行</p>
<ul>
<li><p>ViewPropertyAnimator<br> 连写即可`view.animate()  </p>
<pre><code>.scaleX(1)
.scaleY(1)
.alpha(1);`
</code></pre><p> 这样多个动画是共享动画的开始时间、结束时间、Interpolator 等等一系列的设定</p>
</li>
<li><p>ObjectAnimator</p>
<ul>
<li>PropertyValuesHolder 一个属性动画批量存放地，然后统一放进Animator中执行</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">PropertyValuesHolder holder1 = PropertyValuesHolder.ofFloat(<span class="string">"scaleX"</span>, <span class="number">1</span>);  </span><br><span class="line">PropertyValuesHolder holder2 = PropertyValuesHolder.ofFloat(<span class="string">"scaleY"</span>, <span class="number">1</span>);  </span><br><span class="line">PropertyValuesHolder holder3 = PropertyValuesHolder.ofFloat(<span class="string">"alpha"</span>, <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">ObjectAnimator animator = ObjectAnimator.ofPropertyValuesHolder(view, holder1, holder2, holder3)  </span><br><span class="line">animator.start();</span><br></pre></td></tr></table></figure>
<p>这样多个动画是共享动画的开始时间、结束时间、Interpolator 等等一系列的设定</p>
<ul>
<li><p>AnimatorSet</p>
<p>多个动画配合工作，自定义每个动画的时间，interpolator等设定，还有动画间的执行顺序等</p>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">ObjectAnimator animator1 = ObjectAnimator.ofFloat(...);  </span><br><span class="line">animator1.setInterpolator(<span class="keyword">new</span> LinearInterpolator());  </span><br><span class="line">ObjectAnimator animator2 = ObjectAnimator.ofInt(...);  </span><br><span class="line">animator2.setInterpolator(<span class="keyword">new</span> DecelerateInterpolator());</span><br><span class="line"></span><br><span class="line">AnimatorSet animatorSet = <span class="keyword">new</span> AnimatorSet();  </span><br><span class="line"><span class="comment">// 两个动画依次执行</span></span><br><span class="line">animatorSet.playSequentially(animator1, animator2);  </span><br><span class="line">animatorSet.start();</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>PropertyValuesHolder对于同一个属性的拆分</p>
<p>除了合并多个属性和调配多个动画，你还可以在 PropertyValuesHolder 的基础上更进一步，通过设置  Keyframe （关键帧），把同一个动画属性拆分成多个阶段</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 在 0% 处开始</span></span><br><span class="line">Keyframe keyframe1 = Keyframe.ofFloat(<span class="number">0</span>, <span class="number">0</span>);  </span><br><span class="line"><span class="comment">// 时间经过 50% 的时候，动画完成度 100%</span></span><br><span class="line">Keyframe keyframe2 = Keyframe.ofFloat(<span class="number">0.5f</span>, <span class="number">100</span>);  </span><br><span class="line"><span class="comment">// 时间见过 100% 的时候，动画完成度倒退到 80%，即反弹 20%</span></span><br><span class="line">Keyframe keyframe3 = Keyframe.ofFloat(<span class="number">1</span>, <span class="number">80</span>);  </span><br><span class="line">PropertyValuesHolder holder = PropertyValuesHolder.ofKeyframe(<span class="string">"progress"</span>, keyframe1, keyframe2, keyframe3);</span><br><span class="line"></span><br><span class="line">ObjectAnimator animator = ObjectAnimator.ofPropertyValuesHolder(view, holder);  </span><br><span class="line">animator.start();</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="自定义View-ViewGroup的过程"><a href="#自定义View-ViewGroup的过程" class="headerlink" title="自定义View/ViewGroup的过程"></a>自定义View/ViewGroup的过程</h3><ul>
<li><p>自定义View</p>
<ul>
<li><p>onMeasure</p>
<ul>
<li>没有特别需求可以不必要实现，源码中view会完成测量</li>
<li>在使用wrap_content时，必须实现指定默认大小，不然wrap_content会失效，宽或高成mat_parent的样式</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onMeasure</span><span class="params">(<span class="keyword">int</span> widthMeasureSpec, <span class="keyword">int</span> heightMeasureSpec)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">super</span>.onMeasure(widthMeasureSpec, heightMeasureSpec);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 获取宽-测量规则的模式和大小</span></span><br><span class="line">        <span class="keyword">int</span> widthMode = MeasureSpec.getMode(widthMeasureSpec);</span><br><span class="line">        <span class="keyword">int</span> widthSize = MeasureSpec.getSize(widthMeasureSpec);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 获取高-测量规则的模式和大小</span></span><br><span class="line">        <span class="keyword">int</span> heightMode = MeasureSpec.getMode(heightMeasureSpec);</span><br><span class="line">        <span class="keyword">int</span> heightSize = MeasureSpec.getSize(heightMeasureSpec);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 设置wrap_content的默认宽 / 高值</span></span><br><span class="line">        <span class="comment">// 默认宽/高的设定并无固定依据,根据需要灵活设置</span></span><br><span class="line">        <span class="comment">// 类似TextView,ImageView等针对wrap_content均在onMeasure()对设置默认宽 / 高值有特殊处理,具体读者可以自行查看</span></span><br><span class="line">        <span class="keyword">int</span> mWidth = <span class="number">400</span>;</span><br><span class="line">        <span class="keyword">int</span> mHeight = <span class="number">400</span>;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 当布局参数设置为wrap_content时，设置默认值</span></span><br><span class="line">        <span class="keyword">if</span> (getLayoutParams().width == ViewGroup.LayoutParams.WRAP_CONTENT &amp;&amp; getLayoutParams().height == ViewGroup.LayoutParams.WRAP_CONTENT) &#123;</span><br><span class="line">            setMeasuredDimension(mWidth, mHeight);</span><br><span class="line">        <span class="comment">// 宽 / 高任意一个布局参数为= wrap_content时，都设置默认值</span></span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (getLayoutParams().width == ViewGroup.LayoutParams.WRAP_CONTENT) &#123;</span><br><span class="line">            setMeasuredDimension(mWidth, heightSize);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (getLayoutParams().height == ViewGroup.LayoutParams.WRAP_CONTENT) &#123;</span><br><span class="line">            setMeasuredDimension(widthSize, mHeight);</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>onLayout<br>不必实现，源码中layout()方法已经完成，所以onLayout是空实现</p>
</li>
<li>onDraw<br>必须实现，画出自己需要的图形</li>
</ul>
</li>
<li><p>自定义ViewGroup</p>
<ul>
<li><p>onMeasure</p>
<ul>
<li><p>如果继承的ViewGroup的子类，它们已经有测量的方式，所以不需要实现；</p>
</li>
<li><p>如果继承的ViewGroup，viewGroup中没有对onMeasure（）实现，需要子类根据不同的布局方式实现，那么就需要自定义测量方法了，得到子view的MeasureSpec后调用子view的measure方法，最后需要调用setMeasureDeminson()方法保存测量的宽高值</p>
</li>
</ul>
</li>
<li><p>onLayout</p>
<ul>
<li><p>如果继承的ViewGroup的子类，它们已经有测量的方式，所以不需要实现；</p>
</li>
<li><p>如果继承的ViewGroup，那么就需要自定义布局方法，遍历子view,得到子view的l,t,r,b值后调用子view的layout方法</p>
</li>
</ul>
</li>
<li><p>onDraw</p>
<p>不必实现，画出的图形由子view自行控制,无子view那么就自行实现</p>
</li>
</ul>
</li>
</ul>
<p>出于效率的考虑，ViewGroup 默认会绕过 draw() 方法，换而直接执行 dispatchDraw()，以此来简化绘制流程。所以如果你自定义了某个 ViewGroup 的子类（比如 LinearLayout）并且需要在它的除  dispatchDraw() 以外的任何一个绘制方法内绘制内容，你可能会需要调用 <code>View.setWillNotDraw(false)</code> 这行代码来切换到完整的绘制流程（是「可能」而不是「必须」的原因是，有些 ViewGroup 是已经调用过 setWillNotDraw(false) 了的，例如 ScrollView）。</p>
<h4 id="一些特殊属性的支持"><a href="#一些特殊属性的支持" class="headerlink" title="一些特殊属性的支持"></a>一些特殊属性的支持</h4><ul>
<li><p>支持wrap_content</p>
<p>如果不在onMeasure（）中对wrap_content作特殊处理，那么wrap_content属性将失效</p>
</li>
<li><p>支持padding &amp; margin</p>
<p>如果不支持，那么padding和margin（ViewGroup情况）的属性将失效<br>对于继承View的控件，padding是在draw()中处理，在draw时考虑padding的距离<br>对于继承ViewGroup的控件，padding和margin会直接影响measure和layout过程</p>
</li>
</ul>
<h3 id="滑动中的值"><a href="#滑动中的值" class="headerlink" title="滑动中的值"></a>滑动中的值</h3><p>​      <img src="http://p2qa028as.bkt.clouddn.com/blog/180125/JLbjFh6GCf.png?imageslim" alt="mark"></p>
<p>scrollTo()：表示的是移动到哪个坐标点，坐标点的位置就会移动到屏幕原点的位置</p>
<p>scrollBy()：表示的是移动的增量dx和dy，如果为负值则移动的是相反方向（为正时代表右向左或者下向上）</p>
<p>getScrollX()：屏幕原点X坐标减去调用视图左上角X坐标，例如蓝色图得到的为0-(-480)=480</p>
<p>getScrollY()：屏幕原点Y坐标减去调用视图左上角Y坐标，例如蓝色图得到的为0-0=0</p>
<ul>
<li>getScrollX()得到的是mScrollX的值，mScrollX在scrollTo()调用时赋值</li>
</ul>
<h3 id="canvas画图细节和技巧"><a href="#canvas画图细节和技巧" class="headerlink" title="canvas画图细节和技巧"></a>canvas画图细节和技巧</h3><ul>
<li>canvas画图解析是从下往上解析的</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">canvas.clipRect(-centerX, -centerY, <span class="number">0</span>, centerY);</span><br><span class="line">canvas.rotate(degreeZ);</span><br><span class="line">canvas.translate(-centerX, -centerY);</span><br><span class="line">canvas.drawBitmap(bitmap, x, y, paint);</span><br><span class="line">canvas.restore();</span><br></pre></td></tr></table></figure>
<p>首先重载canvas画布–&gt;画一个图案–&gt;画布移动–&gt;画布旋转–&gt;画布剪切</p>
<ul>
<li>canvas rotate,translate等都是deltaNum,及终点-起点的值</li>
<li>旋转x轴为起点，顺时针为正，逆时针为负；平移右为正，左为负</li>
<li>想实现一个旋转图案出现扫描动画效果，先转，剪切，后转回来，如下：</li>
</ul>
<p>view：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br></pre></td><td class="code"><pre><span class="line">**</span><br><span class="line"> * 整个动画拆分成了三部分</span><br><span class="line"> * &lt;p&gt;</span><br><span class="line"> * Created by jiayuanbin on <span class="number">2017</span>-<span class="number">9</span>-<span class="number">23</span>.</span><br><span class="line"> */</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MapView</span> <span class="keyword">extends</span> <span class="title">View</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//Y轴方向旋转角度</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">float</span> degreeY;</span><br><span class="line">    <span class="comment">//不变的那一半，Y轴方向旋转角度</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">float</span> fixDegreeY;</span><br><span class="line">    <span class="comment">//Z轴方向（平面内）旋转的角度</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">float</span> degreeZ;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> Paint paint;</span><br><span class="line">    <span class="keyword">private</span> Bitmap bitmap;</span><br><span class="line">    <span class="keyword">private</span> Camera camera;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MapView</span><span class="params">(Context context)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>(context, <span class="keyword">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MapView</span><span class="params">(Context context, @Nullable AttributeSet attrs)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>(context, attrs, <span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MapView</span><span class="params">(Context context, @Nullable AttributeSet attrs, <span class="keyword">int</span> defStyleAttr)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(context, attrs, defStyleAttr);</span><br><span class="line">        </span><br><span class="line">        TypedArray a = context.obtainStyledAttributes(attrs, R.styleable.MapView);</span><br><span class="line">        BitmapDrawable drawable = (BitmapDrawable) a.getDrawable(R.styleable.MapView_mv_background);</span><br><span class="line">        a.recycle();</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (drawable != <span class="keyword">null</span>) &#123;</span><br><span class="line">            bitmap = drawable.getBitmap();</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            bitmap = BitmapFactory.decodeResource(getResources(), R.drawable.flip_board);</span><br><span class="line">        &#125;</span><br><span class="line">        paint = <span class="keyword">new</span> Paint(Paint.ANTI_ALIAS_FLAG);</span><br><span class="line">        camera = <span class="keyword">new</span> Camera();</span><br><span class="line">        </span><br><span class="line">        DisplayMetrics displayMetrics = getResources().getDisplayMetrics();</span><br><span class="line">        <span class="keyword">float</span> newZ = -displayMetrics.density * <span class="number">6</span>;</span><br><span class="line">        camera.setLocation(<span class="number">0</span>, <span class="number">0</span>, newZ);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onDraw</span><span class="params">(Canvas canvas)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onDraw(canvas);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">int</span> bitmapWidth = bitmap.getWidth();</span><br><span class="line">        <span class="keyword">int</span> bitmapHeight = bitmap.getHeight();</span><br><span class="line">        <span class="keyword">int</span> centerX = getWidth() / <span class="number">2</span>;</span><br><span class="line">        <span class="keyword">int</span> centerY = getHeight() / <span class="number">2</span>;</span><br><span class="line">        <span class="keyword">int</span> x = centerX - bitmapWidth / <span class="number">2</span>;</span><br><span class="line">        <span class="keyword">int</span> y = centerY - bitmapHeight / <span class="number">2</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//画变换的一半</span></span><br><span class="line">        <span class="comment">//先旋转，再裁切，再使用camera执行3D动效,**然后保存camera效果**,最后再旋转回来</span></span><br><span class="line">        canvas.save();</span><br><span class="line">        camera.save();</span><br><span class="line">        canvas.translate(centerX, centerY);</span><br><span class="line">        canvas.rotate(-degreeZ);</span><br><span class="line">        camera.rotateY(degreeY);</span><br><span class="line">        camera.applyToCanvas(canvas);</span><br><span class="line">        <span class="comment">//计算裁切参数时清注意，此时的canvas的坐标系已经移动</span></span><br><span class="line">        canvas.clipRect(<span class="number">0</span>, -centerY, centerX, centerY);</span><br><span class="line">        canvas.rotate(degreeZ);</span><br><span class="line">        canvas.translate(-centerX, -centerY);</span><br><span class="line">        camera.restore();</span><br><span class="line">        canvas.drawBitmap(bitmap, x, y, paint);</span><br><span class="line">        canvas.restore();</span><br><span class="line">        </span><br><span class="line">       </span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * 每次有一个新的画布，先旋转后再剪切左边一半，所以每次剪切的图案都不一样，</span></span><br><span class="line"><span class="comment">         * 剪切区域不会随着旋转而旋转</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 启动动画之前调用，把参数reset到初始状态</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">reset</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        degreeY = <span class="number">0</span>;</span><br><span class="line">        fixDegreeY = <span class="number">0</span>;</span><br><span class="line">        degreeZ = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Keep</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setFixDegreeY</span><span class="params">(<span class="keyword">float</span> fixDegreeY)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.fixDegreeY = fixDegreeY;</span><br><span class="line">        invalidate();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Keep</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setDegreeY</span><span class="params">(<span class="keyword">float</span> degreeY)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.degreeY = degreeY;</span><br><span class="line">        invalidate();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Keep</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setDegreeZ</span><span class="params">(<span class="keyword">float</span> degreeZ)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.degreeZ = degreeZ;</span><br><span class="line">        invalidate();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setBitmap</span><span class="params">(Bitmap bitmap)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.bitmap = bitmap;</span><br><span class="line">        invalidate();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>activity:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.sunnyxibei.hencoderpractice;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.animation.Animator;</span><br><span class="line"><span class="keyword">import</span> android.animation.AnimatorListenerAdapter;</span><br><span class="line"><span class="keyword">import</span> android.animation.AnimatorSet;</span><br><span class="line"><span class="keyword">import</span> android.animation.ObjectAnimator;</span><br><span class="line"><span class="keyword">import</span> android.graphics.BitmapFactory;</span><br><span class="line"><span class="keyword">import</span> android.os.Bundle;</span><br><span class="line"><span class="keyword">import</span> android.os.Handler;</span><br><span class="line"><span class="keyword">import</span> android.support.v7.app.AppCompatActivity;</span><br><span class="line"><span class="keyword">import</span> android.view.Menu;</span><br><span class="line"><span class="keyword">import</span> android.view.MenuItem;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Handler handler = <span class="keyword">new</span> Handler();</span><br><span class="line">    <span class="keyword">private</span> MapView mapView;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_main);</span><br><span class="line">        initView();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 整个动画被拆分成为三个部分</span></span><br><span class="line"><span class="comment">     * 1、绕Y轴3D旋转45度</span></span><br><span class="line"><span class="comment">     * 2、绕Z轴3D旋转270度</span></span><br><span class="line"><span class="comment">     * 3、不变的那一半（上半部分）绕Y轴旋转30度（注意，这里canvas已经旋转了270度，计算第三个动效参数时要注意）</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">initView</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        mapView =  findViewById(R.id.map_layout);</span><br><span class="line"></span><br><span class="line">        ObjectAnimator animator1 = ObjectAnimator.ofFloat(mapView, <span class="string">"degreeY"</span>, <span class="number">0</span>, -<span class="number">45</span>);</span><br><span class="line">        animator1.setDuration(<span class="number">1000</span>);</span><br><span class="line">        animator1.setStartDelay(<span class="number">500</span>);</span><br><span class="line"></span><br><span class="line">        ObjectAnimator animator2 = ObjectAnimator.ofFloat(mapView, <span class="string">"degreeZ"</span>, <span class="number">0</span>, <span class="number">270</span>);</span><br><span class="line">        animator2.setDuration(<span class="number">800</span>);</span><br><span class="line">        animator2.setStartDelay(<span class="number">500</span>);</span><br><span class="line"></span><br><span class="line">        ObjectAnimator animator3 = ObjectAnimator.ofFloat(mapView, <span class="string">"fixDegreeY"</span>, <span class="number">0</span>, <span class="number">30</span>);</span><br><span class="line">        animator3.setDuration(<span class="number">500</span>);</span><br><span class="line">        animator3.setStartDelay(<span class="number">500</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">final</span> AnimatorSet set = <span class="keyword">new</span> AnimatorSet();</span><br><span class="line">        set.addListener(<span class="keyword">new</span> AnimatorListenerAdapter() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onAnimationEnd</span><span class="params">(Animator animation)</span> </span>&#123;</span><br><span class="line">                <span class="keyword">super</span>.onAnimationEnd(animation);</span><br><span class="line">                handler.postDelayed(<span class="keyword">new</span> Runnable() &#123;</span><br><span class="line">                    <span class="meta">@Override</span></span><br><span class="line">                    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                        runOnUiThread(<span class="keyword">new</span> Runnable() &#123;</span><br><span class="line">                            <span class="meta">@Override</span></span><br><span class="line">                            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                                mapView.reset();</span><br><span class="line">                                set.start();</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;, <span class="number">500</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        set.playSequentially(animator1, animator2, animator3);</span><br><span class="line">        set.start();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onCreateOptionsMenu</span><span class="params">(Menu menu)</span> </span>&#123;</span><br><span class="line">        getMenuInflater().inflate(R.menu.menu_item, menu);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">super</span>.onCreateOptionsMenu(menu);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onOptionsItemSelected</span><span class="params">(MenuItem item)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">switch</span> (item.getItemId()) &#123;</span><br><span class="line">            <span class="keyword">case</span> R.id.google_map:</span><br><span class="line">                mapView.setBitmap(BitmapFactory.decodeResource(getResources(), R.drawable.google_map));</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> R.id.flip_board:</span><br><span class="line">                mapView.setBitmap(BitmapFactory.decodeResource(getResources(), R.drawable.flip_board));</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">super</span>.onOptionsItemSelected(item);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>动画依次执行，在上一个图层旋转完毕后，下一个图层会新建不受上一个影响，剪切位置不会变化，但是图形的旋转角度不同，那么剪切下来的图案就会不一样；随着旋转角度变大，那么反方向旋转回来的时候，就会覆盖上一个图层的空白部分，就好像图案旋转向前了，从而实现了扫描效果</p>
<h3 id="android-studio中的app的class文件目录"><a href="#android-studio中的app的class文件目录" class="headerlink" title="android studio中的app的class文件目录"></a>android studio中的app的class文件目录</h3><p>build &gt; intermediates &gt; classes &gt; debug &gt; company.name &gt; com &gt; app.name</p>
<h3 id="使用gradle打release包，不将密码放在build-gradle中"><a href="#使用gradle打release包，不将密码放在build-gradle中" class="headerlink" title="使用gradle打release包，不将密码放在build.gradle中"></a>使用gradle打release包，不将密码放在build.gradle中</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">Put this into ~/.gradle/gradle.properties</span><br><span class="line"></span><br><span class="line">RELEASE_STORE_FILE=&#123;path to your keystore&#125;</span><br><span class="line">RELEASE_STORE_PASSWORD=*****</span><br><span class="line">RELEASE_KEY_ALIAS=*****</span><br><span class="line">RELEASE_KEY_PASSWORD=*****</span><br><span class="line">Modify your build.gradle like this:</span><br><span class="line"></span><br><span class="line">...    </span><br><span class="line">signingConfigs &#123;</span><br><span class="line"></span><br><span class="line">   release &#123;</span><br><span class="line">       storeFile file(RELEASE_STORE_FILE)</span><br><span class="line">       storePassword RELEASE_STORE_PASSWORD</span><br><span class="line">       keyAlias RELEASE_KEY_ALIAS</span><br><span class="line">       keyPassword RELEASE_KEY_PASSWORD</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">buildTypes &#123;</span><br><span class="line">        release &#123;</span><br><span class="line">            signingConfig signingConfigs.release</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line">....</span><br><span class="line">Then you can run gradle assembleRelease</span><br></pre></td></tr></table></figure>
<h3 id="RecyclerView-notify的注意点"><a href="#RecyclerView-notify的注意点" class="headerlink" title="RecyclerView notify的注意点"></a>RecyclerView notify的注意点</h3><ul>
<li>notify前后的数据源是否时同一个地址，要是内存地址有变化刷新会无效</li>
<li>对于notify前后的viewHolder不一样的，需要根据viewType来判断加载不同的viewHolder才行，onCreateViewHolder官方说明中有这样说明：<code>This new ViewHolder should be constructed with a new View that can represent the itemsof the given type. You can either create a new View manually or inflate it from an XML layout file.</code>需要根据item type判断create new viewHolder</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getItemCount</span><span class="params">()</span> </span>&#123;</span><br><span class="line">       <span class="keyword">return</span> hasSettingRecord ? attendanceGroupList.size() : <span class="number">3</span>;</span><br><span class="line">   &#125;</span><br><span class="line">   </span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getItemViewType</span><span class="params">(<span class="keyword">int</span> position)</span> </span>&#123;</span><br><span class="line">       <span class="keyword">if</span> (hasSettingRecord) &#123;</span><br><span class="line">           <span class="keyword">return</span> HAS_SETTING;</span><br><span class="line">       &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">           <span class="keyword">return</span> NO_SETTING;</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br><span class="line">   </span><br><span class="line"></span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="keyword">public</span> RecyclerView.<span class="function">ViewHolder <span class="title">onCreateViewHolder</span><span class="params">(ViewGroup parent, <span class="keyword">int</span> viewType)</span> </span>&#123;</span><br><span class="line">       View view;</span><br><span class="line">       <span class="keyword">if</span> (viewType == HAS_SETTING) &#123;</span><br><span class="line">           view = LayoutInflater.from(mContext).inflate(R.layout.item_office_setting, parent, <span class="keyword">false</span>);</span><br><span class="line">           <span class="keyword">return</span> <span class="keyword">new</span> HasSettingViewHolder(view);</span><br><span class="line">       &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">           view = LayoutInflater.from(mContext).inflate(R.layout.item_office_un_setting, parent, <span class="keyword">false</span>);</span><br><span class="line">           <span class="keyword">return</span> <span class="keyword">new</span> UnSettingViewHolder(view, customItemClickListener);</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br><span class="line">   </span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onBindViewHolder</span><span class="params">(RecyclerView.ViewHolder holder, <span class="keyword">int</span> position)</span> </span>&#123;</span><br><span class="line">       <span class="keyword">if</span> (hasSettingRecord &amp;&amp; holder <span class="keyword">instanceof</span> HasSettingViewHolder) &#123;</span><br><span class="line">           displayHasSetting((HasSettingViewHolder) holder, position);</span><br><span class="line">       &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">           displayUnSetting((UnSettingViewHolder) holder, position);</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<h3 id="ViewStub注意点"><a href="#ViewStub注意点" class="headerlink" title="ViewStub注意点"></a>ViewStub注意点</h3><ul>
<li>viewStub使用市需要指定<code>inflatedId</code>(任意取名)和<code>layout</code>（指定需要替换viewStub的布局文件）</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">ViewStub</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:id</span>=<span class="string">"@+id/ll_company_info_checking_sub"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">"0dp"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:inflatedId</span>=<span class="string">"@+id/ll_company_info_checking"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout</span>=<span class="string">"@layout/item_attendacne_conpamy_list_adapter_checking"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">app:layout_constraintLeft_toLeftOf</span>=<span class="string">"@+id/tv_company_name"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">app:layout_constraintRight_toRightOf</span>=<span class="string">"parent"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">app:layout_constraintTop_toBottomOf</span>=<span class="string">"@+id/tv_company_address"</span>/&gt;</span></span><br></pre></td></tr></table></figure>
<p>item_attendacne_conpamy_list_adapter_checking.xml: </p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">LinearLayout</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></span></span><br><span class="line"><span class="tag">              <span class="attr">xmlns:tools</span>=<span class="string">"http://schemas.android.com/tools"</span></span></span><br><span class="line"><span class="tag">              <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">              <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">              <span class="attr">android:layout_marginEnd</span>=<span class="string">"15dp"</span></span></span><br><span class="line"><span class="tag">              <span class="attr">android:paddingBottom</span>=<span class="string">"20dp"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">TextView</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">"@+id/tv_company_checking_status"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:textColor</span>=<span class="string">"@color/color_light_gray"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:textSize</span>=<span class="string">"12sp"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">tools:text</span>=<span class="string">"审核中（提交时间：2017-05-11  16:00）"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>使用方法</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">@BindView</span>(R.id.ll_company_info_checking_sub)</span><br><span class="line"> ViewStub llCompanyInfoCheckingSub;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (llCompanyInfoSub.getParent() != <span class="keyword">null</span>) &#123;</span><br><span class="line">   View llNormal = llCompanyInfoSub.inflate();</span><br><span class="line">TextView tvCompanyCount = (TextView) llNormal.findViewById(R.id.tv_company_count);</span><br><span class="line">   TextView tvDepartmentCount = (TextView) llNormal.findViewById(R.id.tv_department_count);</span><br><span class="line">   TextView tvCheckTime = (TextView) llNormal.findViewById(R.id.tv_check_time);</span><br><span class="line">...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>首先找到viewStub,inflate后可以得到layout中指定的布局文件对象，之后findViewById就可以找到布局中的view</p>
<p>注意：viewStub在inflate一次后就会从原来的试图中移除，移除后的parent会为null，进行重复的inflate操作时会报parent为null错误，因为viewstub是一次性的，所以更新试图的时候需要重新加载一次xml文件才行</p>
<h3 id="intent传递数据的替代"><a href="#intent传递数据的替代" class="headerlink" title="intent传递数据的替代"></a>intent传递数据的替代</h3><p>代替intent在组件间传递数据的方式：</p>
<ul>
<li>如果需要在关闭app后数据任然存在，那么可以使用SP,sqlite,sdcardd等</li>
<li>要是只是在app运行期间传递数据，那么可以使用静态变量或者一个一个保存临时变量的类</li>
</ul>
<p>替代intent传递数据的原因：一个数据从一个组件传递到另一个组件，单次传递找到数据初始化的地方很容易，但是一旦一个数据需要传递多次，到了好几层后才会使用到，那么在分析代码或者找bug的时候就会很不容易找到赋值的地方，代替的使用一个静态变量或者临时变量储存类就会更加清晰。</p>
<h3 id="ImageView加载不出来bitmap"><a href="#ImageView加载不出来bitmap" class="headerlink" title="ImageView加载不出来bitmap"></a>ImageView加载不出来bitmap</h3><p>如果<code>iv.setImageBitmap(bitmap);</code>有问题，就将bitmap转成drawable后设置</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Drawable d = <span class="keyword">new</span> BitmapDrawable(getResources(), bitmap);</span><br><span class="line">iv.setImageDrawable(d);</span><br></pre></td></tr></table></figure>
<h3 id="Rxjava2-doOnxx方法"><a href="#Rxjava2-doOnxx方法" class="headerlink" title="Rxjava2 doOnxx方法"></a>Rxjava2 doOnxx方法</h3><p>都是对用的onXXX方法后调用，onXXX方法的调用会唤起一个action传递给doOnXXX,可以在doOnXXX中做一些额外的操作，比如给用户提示，但是不要试图改变流的行为</p>
<ul>
<li>doOnError</li>
</ul>
<p>/**</p>
<ul>
<li>onError调用时会唤起一个action</li>
<li>会获取一个onError和数据流中的复合异常</li>
<li>只有使用了onError后doOnError才会有意义，不使用onError的话异常还是不会被捕获，也不会到doOnError中</li>
<li>但是doOnError调用的时机必须在数据流发生异常之前，因为流都是向下的，经过了的异常捕捉方法不会再接收到异常</li>
<li>若不在发生异常时加额外的处理，那么doOnError也就相当于添加了两个异常监听<br> *</li>
<li>the doOn??? methods are there for side-effects, processing that doesn’t really is your core</li>
<li>business value let’s say. Logging is a perfectly fine use for that. That said, sometimes</li>
<li>you want to do something more meaningful with an error, like retrying, or displaying a</li>
<li>message to a user, etc… For these cases, the “rx” way would be to process the error in a</li>
<li><p>subscribe call.</p>
<p>doOnError (and the other doOn methods) wraps the original Observable into a new one and adds<br>behavior to it (around its onError method, obviously). That’s why you can call it many times.<br>Also one benefit of being able to call it anywhere in the chain is that you can access errors<br>that would otherwise be hidden from the consumer of the stream (the Subscriber), for instance<br>because there’s a retry down in the chain…<br>*/</p>
</li>
</ul>
<h3 id="获取manifest文件中组件中节点下的value数据"><a href="#获取manifest文件中组件中节点下的value数据" class="headerlink" title="获取manifest文件中组件中节点下的value数据"></a>获取manifest文件中组件中<meta-data>节点下的value数据</meta-data></h3><pre><code>activity.getPackageManager().getActivityInfo(activity.getComponentName(), flag).metaData.getString(&quot;android.app.mode&quot;));
</code></pre><h3 id="view的点击水波纹"><a href="#view的点击水波纹" class="headerlink" title="view的点击水波纹"></a>view的点击水波纹</h3><p>对于点击的波效果，如果想去掉原生的，可以将<code>android:background=&quot;@null&quot;</code>,若是需要点击的背景水波纹，只需要加上背景就可以了</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">RelativeLayout</span></span></span><br><span class="line"><span class="tag">  <span class="attr">android:id</span>=<span class="string">"@+id/ll_bang_bang"</span></span></span><br><span class="line"><span class="tag">  <span class="attr">android:layout_width</span>=<span class="string">"0dp"</span></span></span><br><span class="line"><span class="tag">  <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">  <span class="attr">android:layout_weight</span>=<span class="string">"1"</span></span></span><br><span class="line"><span class="tag">  <span class="attr">android:background</span>=<span class="string">"@drawable/ripple_bg"</span></span></span><br><span class="line"><span class="tag">  <span class="attr">android:gravity</span>=<span class="string">"center"</span></span></span><br><span class="line"><span class="tag">  <span class="attr">android:paddingBottom</span>=<span class="string">"3dp"</span></span></span><br><span class="line"><span class="tag">  <span class="attr">android:paddingTop</span>=<span class="string">"3dp"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">RelativeLayout</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>ripple_bg.xml<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version="1.0" encoding="utf-8"?&gt; <span class="tag">&lt;<span class="name">selector</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">item</span> <span class="attr">android:drawable</span>=<span class="string">"@color/white"</span>/&gt;</span> <span class="tag">&lt;/<span class="name">selector</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>会出现点击的波纹效果</p>
<p>需要去掉的话：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">RelativeLayout</span></span></span><br><span class="line"><span class="tag">  <span class="attr">android:id</span>=<span class="string">"@+id/ll_bang_bang"</span></span></span><br><span class="line"><span class="tag">  <span class="attr">android:layout_width</span>=<span class="string">"0dp"</span></span></span><br><span class="line"><span class="tag">  <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">  <span class="attr">android:layout_weight</span>=<span class="string">"1"</span></span></span><br><span class="line"><span class="tag">  <span class="attr">android:gravity</span>=<span class="string">"center"</span></span></span><br><span class="line"><span class="tag">  <span class="attr">android:paddingBottom</span>=<span class="string">"3dp"</span></span></span><br><span class="line"><span class="tag">  <span class="attr">android:paddingTop</span>=<span class="string">"3dp"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">RelativeLayout</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<h3 id="解决重复点击"><a href="#解决重复点击" class="headerlink" title="解决重复点击"></a>解决重复点击</h3><ol>
<li><p>继承<code>View.OnClickListener</code>控制</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"> <span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">DebouncingOnClickListener</span> <span class="keyword">implements</span> <span class="title">View</span>.<span class="title">OnClickListener</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">boolean</span> enabled = <span class="keyword">true</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Runnable ENABLE_AGAIN = <span class="keyword">new</span> Runnable() &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span> <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        enabled = <span class="keyword">true</span>;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span> </span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View v)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (enabled) &#123;</span><br><span class="line"></span><br><span class="line">        enabled = <span class="keyword">false</span>;</span><br><span class="line"></span><br><span class="line">        v.post(ENABLE_AGAIN);</span><br><span class="line"></span><br><span class="line">        doClick(v);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">doClick</span><span class="params">(View v)</span></span>;</span><br></pre></td></tr></table></figure>
</li>
<li><p>在点击时控制</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> <span class="keyword">long</span>[] mHits = <span class="keyword">new</span> <span class="keyword">long</span>[<span class="number">2</span>];</span><br><span class="line">System.arraycopy(mHits, <span class="number">1</span>, mHits, <span class="number">0</span>, mHits.length - <span class="number">1</span>);</span><br><span class="line">               mHits[mHits.length - <span class="number">1</span>] = SystemClock.uptimeMillis();</span><br><span class="line">			<span class="comment">//两次点击的间隔500ms</span></span><br><span class="line">               <span class="keyword">if</span> (mHits[<span class="number">1</span>] &gt;= (mHits[<span class="number">0</span>] + <span class="number">500</span>)) &#123;</span><br><span class="line">                   <span class="comment">//点击后的逻辑</span></span><br><span class="line">               &#125;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="实现双击事件"><a href="#实现双击事件" class="headerlink" title="实现双击事件"></a>实现双击事件</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">//长度是几就是几次点击才响应次个事件 现在是实现双击事件</span></span><br><span class="line"><span class="keyword">long</span>[] mHits = <span class="keyword">new</span> <span class="keyword">long</span>[<span class="number">2</span>];  </span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">click</span><span class="params">(View view)</span></span>&#123;  </span><br><span class="line">	System.arraycopy(mHits, <span class="number">1</span>, mHits, <span class="number">0</span>, mHits.length-<span class="number">1</span>);  </span><br><span class="line">	mHits[ mHits. length-<span class="number">1</span>] = SystemClock. uptimeMillis();  </span><br><span class="line">	<span class="keyword">if</span> ( mHits[<span class="number">1</span>] &gt;= (SystemClock. uptimeMillis()-<span class="number">500</span>)) &#123;</span><br><span class="line">		Toast. makeText(<span class="keyword">this</span>,<span class="string">"hello world from TreeClcik"</span>, <span class="number">1</span>).show();  </span><br><span class="line">	&#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="判断键盘是否弹出"><a href="#判断键盘是否弹出" class="headerlink" title="判断键盘是否弹出"></a>判断键盘是否弹出</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">rootView.getViewTreeObserver().addOnGlobalLayoutListener(<span class="keyword">new</span> ViewTreeObserver.OnGlobalLayoutListener() &#123;</span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onGlobalLayout</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      <span class="keyword">int</span> heightDiff = rootView.getRootView().getHeight() - rootView.getHeight();</span><br><span class="line">      <span class="keyword">if</span> (heightDiff &gt; DisplayUtil.dip2px(context, <span class="number">200</span>)) &#123;</span><br><span class="line">      <span class="comment">// if more than 200 dp, it's probably a keyboard</span></span><br><span class="line">      &#125;</span><br><span class="line">   &#125; </span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h3 id="ScrollView滑动到底部-顶部"><a href="#ScrollView滑动到底部-顶部" class="headerlink" title="ScrollView滑动到底部/顶部"></a>ScrollView滑动到底部/顶部</h3><ul>
<li>使用<code>scrollview.funnScroll()</code></li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">scrollview.post(<span class="keyword">new</span> Runnable() &#123;</span><br><span class="line"> <span class="meta">@Override</span></span><br><span class="line"> <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">   scrollview.fullScroll(View.FOCUS_DOWN);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>这个方法会改变焦点的变化，引起一些奇怪的变化，所以下一种选择更好</p>
<ul>
<li>使用<code>scrollview.smoothScrollTo()</code><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//因为更新view都是队列实现，所以需要post到队列中，不然不生效</span></span><br><span class="line">scrollview.post(<span class="keyword">new</span> Runnable() &#123;</span><br><span class="line"> <span class="meta">@Override</span></span><br><span class="line"> <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  scrollview.smoothScrollTo(<span class="number">0</span>,scrollview.getHeight());</span><br><span class="line"> &#125; &#125;);</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="键盘弹出时需要将内容上顶"><a href="#键盘弹出时需要将内容上顶" class="headerlink" title="键盘弹出时需要将内容上顶"></a>键盘弹出时需要将内容上顶</h3><ul>
<li>如果键盘弹出时需要将内容全部上顶，将键盘位置空出来</li>
</ul>
<p>首先：在Mainfest.xml中设置这个activity的<code>android:windowSoftInputMode=&quot;adjustResize&quot;</code></p>
<p>其次：在xml布局中使用ScrollView,键盘弹出时将ScrollView会上顶</p>
<ul>
<li>如果需要键盘弹出不需要上顶，但是内容可以滑动</li>
</ul>
<p>首先：在Mainfest.xml中设置这个activity的<code>android:windowSoftInputMode=&quot;adjustPan&quot;</code></p>
<p>其次：在xml布局中使用ScrollView,键盘弹出时ScrollView不会上顶，但是被覆盖的内容可以滑动</p>
<h3 id="Dialog使用wrap-content"><a href="#Dialog使用wrap-content" class="headerlink" title="Dialog使用wrap_content"></a>Dialog使用wrap_content</h3><p>Dialog默认是悬浮在activity之上的，也就没有activity的rootView作为父view，那么设置wrap_contnet是不会生效的，默认都会占满整屏。要是需要wrap_content生效</p>
<ul>
<li><p>xml中设置方法</p>
</li>
<li><p>代码中设置方法</p>
</li>
</ul>
<h3 id="minHeight和padding的关系"><a href="#minHeight和padding的关系" class="headerlink" title="minHeight和padding的关系"></a>minHeight和padding的关系</h3><p>minHeight如果大于内容高度+padding，那么就会使用minHeight，否者就使用内容+padding的高度最后view的高度</p>
<p>###ImageView不垂直居中问题</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">LinearLayout</span></span></span><br><span class="line"><span class="tag">  <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">  <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">  <span class="attr">android:orientation</span>=<span class="string">"horizontal"</span>&gt;</span>   </span><br><span class="line">	<span class="tag">&lt;<span class="name">RelativeLayout</span></span></span><br><span class="line"><span class="tag">	  <span class="attr">android:layout_width</span>=<span class="string">"0dp"</span></span></span><br><span class="line"><span class="tag">	  <span class="attr">android:layout_height</span>=<span class="string">"15dp"</span></span></span><br><span class="line"><span class="tag">	  <span class="attr">android:layout_gravity</span>=<span class="string">"center_vertical"</span></span></span><br><span class="line"><span class="tag">	  <span class="attr">android:layout_weight</span>=<span class="string">"1"</span>&gt;</span>  </span><br><span class="line">		<span class="tag">&lt;<span class="name">ImageView</span></span></span><br><span class="line"><span class="tag">		  <span class="attr">android:layout_width</span>=<span class="string">"15dp"</span></span></span><br><span class="line"><span class="tag">		  <span class="attr">android:layout_height</span>=<span class="string">"15dp"</span></span></span><br><span class="line"><span class="tag">		  <span class="attr">android:background</span>=<span class="string">"@drawable/image_attention"</span>/&gt;</span></span><br><span class="line">	 <span class="tag">&lt;/<span class="name">RelativeLayout</span>&gt;</span>   </span><br><span class="line">	<span class="tag">&lt;<span class="name">TextView</span></span></span><br><span class="line"><span class="tag">	  <span class="attr">android:layout_width</span>=<span class="string">"0dp"</span></span></span><br><span class="line"><span class="tag">	  <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">	  <span class="attr">android:layout_toEndOf</span>=<span class="string">"@+id/view_title_3"</span></span></span><br><span class="line"><span class="tag">	  <span class="attr">android:layout_weight</span>=<span class="string">"1.75"</span></span></span><br><span class="line"><span class="tag">	  <span class="attr">android:text</span>=<span class="string">"可以插入哪些商品？"</span></span></span><br><span class="line"><span class="tag">	  <span class="attr">android:textColor</span>=<span class="string">"#737373"</span></span></span><br><span class="line"><span class="tag">	  <span class="attr">android:textSize</span>=<span class="string">"14sp"</span>/&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>此时显示的图片会默认向上向左偏移，原因未知</p>
<p><img src="pic/imageView%E4%B8%AD%E7%9A%84%E5%9B%BE%E7%89%87%E9%BB%98%E8%AE%A4%E5%90%91%E4%B8%8A%E5%92%8C%E5%90%91%E5%B7%A6%E5%81%8F%E7%A7%BB.png" alt="imageView中的图片默认向上和向左偏移"></p>
<p>解决：</p>
<p>在RelativeLayout中设置marginTop为1dp，此时看起来的效果是垂直居中的，<strong>不能设置在imageview上，不然图片会被压扁</strong></p>
<h3 id="java内部类"><a href="#java内部类" class="headerlink" title="java内部类"></a>java内部类</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">A</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">aa</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        B b = <span class="keyword">new</span> B();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">B</span> </span>&#123;</span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            C c = <span class="keyword">new</span> C();</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="class"><span class="keyword">class</span> <span class="title">C</span> </span>&#123;</span><br><span class="line">        </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="一个数一定时间内一个范围内变化"><a href="#一个数一定时间内一个范围内变化" class="headerlink" title="一个数一定时间内一个范围内变化"></a>一个数一定时间内一个范围内变化</h3><p>​    可以使用属性动画的<code>PropertyValuesHolder</code> </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//让一个数在2s内从0变化到150</span></span><br><span class="line">PropertyValuesHolder propertyRadius = PropertyValuesHolder.ofInt(PROPERTY_RADIUS, <span class="number">0</span>, <span class="number">150</span>);</span><br><span class="line">PropertyValuesHolder propertyRotate = PropertyValuesHolder.ofInt(PROPERTY_ROTATE, <span class="number">0</span>, <span class="number">360</span>);</span><br><span class="line"></span><br><span class="line">animator = <span class="keyword">new</span> ValueAnimator();</span><br><span class="line">animator.setValues(propertyRadius, propertyRotate);</span><br><span class="line">animator.setDuration(<span class="number">2000</span>);</span><br><span class="line">animator.addUpdateListener(<span class="keyword">new</span> ValueAnimator.AnimatorUpdateListener() &#123;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onAnimationUpdate</span><span class="params">(ValueAnimator animation)</span> </span>&#123;</span><br><span class="line">		radius = (<span class="keyword">int</span>) animation.getAnimatedValue(PROPERTY_RADIUS);</span><br><span class="line">		rotate = (<span class="keyword">int</span>) animation.getAnimatedValue(PROPERTY_ROTATE);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;);</span><br><span class="line">animator.start();</span><br></pre></td></tr></table></figure>
<h3 id="TypeEvaluator和Interpolator"><a href="#TypeEvaluator和Interpolator" class="headerlink" title="TypeEvaluator和Interpolator"></a>TypeEvaluator和Interpolator</h3><ul>
<li><p>Interpolator插值器</p>
<p> 设置 属性值 从初始值过渡到结束值 的变化规律 。如匀速、加速 &amp; 减速 等等</p>
</li>
<li><p>TypeEvaluator估值器</p>
<p> 设置 属性值 从初始值过渡到结束值 的变化具体数值 ​</p>
</li>
</ul>
  
	</div>
		<footer class="article-footer clearfix">
<div class="article-catetags">


</div>



	<div class="article-share" id="share">
	
	  <div data-url="http://yoursite.com/2018/01/28/android/小细节/" data-title="Hexo" data-tsina="" class="share clearfix">
	  </div>
	
	</div>


</footer>

   	       
	</article>
	
<nav class="article-nav clearfix">
 
 <div class="prev" >
 <a href="/2018/01/28/other/UML/" title="">
  <strong>上一篇：</strong><br/>
  <span>
  (no title)</span>
</a>
</div>


<div class="next">
<a href="/2014/11/07/hello-world/"  title="hello-world">
 <strong>下一篇：</strong><br/> 
 <span>hello-world
</span>
</a>
</div>

</nav>

	



</div>  
      <div class="openaside"><a class="navbutton" href="#" title="Show Sidebar"></a></div>

  <div id="toc" class="toc-aside">
  <strong class="toc-title">Contents</strong>
 
 <ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#限制EditText输入的字数"><span class="toc-number">1.</span> <span class="toc-text">限制EditText输入的字数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#EditText只接受数字，其余无法输入到EditText中"><span class="toc-number">2.</span> <span class="toc-text">EditText只接受数字，其余无法输入到EditText中</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#EditText修改Cursor颜色"><span class="toc-number">3.</span> <span class="toc-text">EditText修改Cursor颜色</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#EditText密码输入框的可见与不可见切换"><span class="toc-number">4.</span> <span class="toc-text">EditText密码输入框的可见与不可见切换</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#EditText属性设置"><span class="toc-number">5.</span> <span class="toc-text">EditText属性设置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#android-windowSoftInputMode属性详解"><span class="toc-number">6.</span> <span class="toc-text">android:windowSoftInputMode属性详解</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Android-MarginLeft与MarginStart的区别"><span class="toc-number">7.</span> <span class="toc-text">Android MarginLeft与MarginStart的区别</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Fragment数据懒加载"><span class="toc-number">8.</span> <span class="toc-text">Fragment数据懒加载</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ScrollView嵌套LinearLayout-LinearLayout不铺满屏幕问题"><span class="toc-number">9.</span> <span class="toc-text">ScrollView嵌套LinearLayout,LinearLayout不铺满屏幕问题</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#RecyclerView使用注意"><span class="toc-number">10.</span> <span class="toc-text">RecyclerView使用注意</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#实现嵌套滑动"><span class="toc-number">11.</span> <span class="toc-text">实现嵌套滑动</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#java继承细节"><span class="toc-number">12.</span> <span class="toc-text">java继承细节</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ScrollView监听滑动到底部和顶部"><span class="toc-number">13.</span> <span class="toc-text">ScrollView监听滑动到底部和顶部</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#属性动画"><span class="toc-number">14.</span> <span class="toc-text">属性动画</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#自定义View-ViewGroup的过程"><span class="toc-number">15.</span> <span class="toc-text">自定义View/ViewGroup的过程</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#一些特殊属性的支持"><span class="toc-number">15.1.</span> <span class="toc-text">一些特殊属性的支持</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#滑动中的值"><span class="toc-number">16.</span> <span class="toc-text">滑动中的值</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#canvas画图细节和技巧"><span class="toc-number">17.</span> <span class="toc-text">canvas画图细节和技巧</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#android-studio中的app的class文件目录"><span class="toc-number">18.</span> <span class="toc-text">android studio中的app的class文件目录</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#使用gradle打release包，不将密码放在build-gradle中"><span class="toc-number">19.</span> <span class="toc-text">使用gradle打release包，不将密码放在build.gradle中</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#RecyclerView-notify的注意点"><span class="toc-number">20.</span> <span class="toc-text">RecyclerView notify的注意点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ViewStub注意点"><span class="toc-number">21.</span> <span class="toc-text">ViewStub注意点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#intent传递数据的替代"><span class="toc-number">22.</span> <span class="toc-text">intent传递数据的替代</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ImageView加载不出来bitmap"><span class="toc-number">23.</span> <span class="toc-text">ImageView加载不出来bitmap</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Rxjava2-doOnxx方法"><span class="toc-number">24.</span> <span class="toc-text">Rxjava2 doOnxx方法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#获取manifest文件中组件中节点下的value数据"><span class="toc-number">25.</span> <span class="toc-text">获取manifest文件中组件中节点下的value数据</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#view的点击水波纹"><span class="toc-number">26.</span> <span class="toc-text">view的点击水波纹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#解决重复点击"><span class="toc-number">27.</span> <span class="toc-text">解决重复点击</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#实现双击事件"><span class="toc-number">28.</span> <span class="toc-text">实现双击事件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#判断键盘是否弹出"><span class="toc-number">29.</span> <span class="toc-text">判断键盘是否弹出</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ScrollView滑动到底部-顶部"><span class="toc-number">30.</span> <span class="toc-text">ScrollView滑动到底部/顶部</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#键盘弹出时需要将内容上顶"><span class="toc-number">31.</span> <span class="toc-text">键盘弹出时需要将内容上顶</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Dialog使用wrap-content"><span class="toc-number">32.</span> <span class="toc-text">Dialog使用wrap_content</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#minHeight和padding的关系"><span class="toc-number">33.</span> <span class="toc-text">minHeight和padding的关系</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#java内部类"><span class="toc-number">34.</span> <span class="toc-text">java内部类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#一个数一定时间内一个范围内变化"><span class="toc-number">35.</span> <span class="toc-text">一个数一定时间内一个范围内变化</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#TypeEvaluator和Interpolator"><span class="toc-number">36.</span> <span class="toc-text">TypeEvaluator和Interpolator</span></a></li></ol>
 
  </div>

<div id="asidepart">
<div class="closeaside"><a class="closebutton" href="#" title="Hide Sidebar"></a></div>
<aside class="clearfix">

  


  
<div class="categorieslist">
	<p class="asidetitle">Categories</p>
		<ul>
		
		  
			<li><a href="/categories/other/" title="other">other<sup>1</sup></a></li>
		  
		
		</ul>
</div>


  
<div class="tagslist">
	<p class="asidetitle">Tags</p>
		<ul class="clearfix">
		
			
				<li><a href="/tags/hello/" title="hello">hello<sup>1</sup></a></li>
			
		
		</ul>
</div>


  <div class="linkslist">
  <p class="asidetitle">Links</p>
    <ul>
        
    </ul>
</div>

</aside>
</div>
    </div>
    <footer><div id="footer" >
	
	<div class="line">
		<span></span>
		<div class="author"></div>
	</div>
	
	
	<div class="social-font" class="clearfix">
		
		
		
		
		
		
		
		
		
		
	</div>
			
		

		<p class="copyright">
		Powered by <a href="http://hexo.io" target="_blank" title="hexo">hexo</a> and Theme by <a href="https://github.com/wuchong/jacman" target="_blank" title="Jacman">Jacman</a> © 2018 
		
		<a href="/about" target="_blank" title="John Doe">John Doe</a>
		
		
		</p>
</div>
</footer>
    <script src="/js/jquery-2.0.3.min.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="/js/jquery.qrcode-0.12.0.min.js"></script>

<script type="text/javascript">
$(document).ready(function(){ 
  $('.navbar').click(function(){
    $('header nav').toggleClass('shownav');
  });
  var myWidth = 0;
  function getSize(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
  };
  var m = $('#main'),
      a = $('#asidepart'),
      c = $('.closeaside'),
      o = $('.openaside');
  c.click(function(){
    a.addClass('fadeOut').css('display', 'none');
    o.css('display', 'block').addClass('fadeIn');
    m.addClass('moveMain');
  });
  o.click(function(){
    o.css('display', 'none').removeClass('beforeFadeIn');
    a.css('display', 'block').removeClass('fadeOut').addClass('fadeIn');      
    m.removeClass('moveMain');
  });
  $(window).scroll(function(){
    o.css("top",Math.max(80,260-$(this).scrollTop()));
  });
  
  $(window).resize(function(){
    getSize(); 
    if (myWidth >= 1024) {
      $('header nav').removeClass('shownav');
    }else{
      m.removeClass('moveMain');
      a.css('display', 'block').removeClass('fadeOut');
      o.css('display', 'none');
      
      $('#toc.toc-aside').css('display', 'none');
        
    }
  });
});
</script>

<script type="text/javascript">
$(document).ready(function(){ 
  var ai = $('.article-content>iframe'),
      ae = $('.article-content>embed'),
      t  = $('#toc'),
      ta = $('#toc.toc-aside'),
      o  = $('.openaside'),
      c  = $('.closeaside');
  if(ai.length>0){
    ai.wrap('<div class="video-container" />');
  };
  if(ae.length>0){
   ae.wrap('<div class="video-container" />');
  };
  c.click(function(){
    ta.css('display', 'block').addClass('fadeIn');
  });
  o.click(function(){
    ta.css('display', 'none');
  });
  $(window).scroll(function(){
    ta.css("top",Math.max(140,320-$(this).scrollTop()));
  });
});
</script>


<script type="text/javascript">
$(document).ready(function(){ 
  var $this = $('.share'),
      url = $this.attr('data-url'),
      encodedUrl = encodeURIComponent(url),
      title = $this.attr('data-title'),
      tsina = $this.attr('data-tsina'),
      description = $this.attr('description');
  var html = [
  '<div class="hoverqrcode clearfix"></div>',
  '<a class="overlay" id="qrcode"></a>',
  '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="article-share-facebook" target="_blank" title="Facebook"></a>',
  '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="article-share-twitter" target="_blank" title="Twitter"></a>',
  '<a href="#qrcode" class="article-share-qrcode" title="微信"></a>',
  '<a href="http://widget.renren.com/dialog/share?resourceUrl=' + encodedUrl + '&srcUrl=' + encodedUrl + '&title=' + title +'" class="article-share-renren" target="_blank" title="人人"></a>',
  '<a href="http://service.weibo.com/share/share.php?title='+title+'&url='+encodedUrl +'&ralateUid='+ tsina +'&searchPic=true&style=number' +'" class="article-share-weibo" target="_blank" title="微博"></a>',
  '<span title="Share to"></span>'
  ].join('');
  $this.append(html);

  $('.hoverqrcode').hide();

  var myWidth = 0;
  function updatehoverqrcode(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
    var qrsize = myWidth > 1024 ? 200:100;
    var options = {render: 'image', size: qrsize, fill: '#2ca6cb', text: url, radius: 0.5, quiet: 1};
    var p = $('.article-share-qrcode').position();
    $('.hoverqrcode').empty().css('width', qrsize).css('height', qrsize)
                          .css('left', p.left-qrsize/2+20).css('top', p.top-qrsize-10)
                          .qrcode(options);
  };
  $(window).resize(function(){
    $('.hoverqrcode').hide();
  });
  $('.article-share-qrcode').click(function(){
    updatehoverqrcode();
    $('.hoverqrcode').toggle();
  });
  $('.article-share-qrcode').hover(function(){}, function(){
      $('.hoverqrcode').hide();
  });
});   
</script>











<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
$(document).ready(function(){ 
  $('.article-content').each(function(i){
    $(this).find('img').each(function(){
      if ($(this).parent().hasClass('fancybox')) return;
      var alt = this.alt;
      if (alt) $(this).after('<span class="caption">' + alt + '</span>');
      $(this).wrap('<a href="' + this.src + '" title="' + alt + '" class="fancybox"></a>');
    });
    $(this).find('.fancybox').each(function(){
      $(this).attr('rel', 'article' + i);
    });
  });
  if($.fancybox){
    $('.fancybox').fancybox();
  }
}); 
</script>



<!-- Analytics Begin -->



<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?e6d1f421bbc9962127a50488f9ed37d1";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>



<!-- Analytics End -->

<!-- Totop Begin -->

	<div id="totop">
	<a title="Back to Top"><img src="/img/scrollup.png"/></a>
	</div>
	<script src="/js/totop.js"></script>

<!-- Totop End -->

<!-- MathJax Begin -->
<!-- mathjax config similar to math.stackexchange -->


<!-- MathJax End -->

<!-- Tiny_search Begin -->

<!-- Tiny_search End -->

  </body>
</html>
